function getTotal(){fetch("https://api.eallion.com/memos/api/v1/memo/stats?creatorId=101").then((e=>e.json())).then((e=>{if(Array.isArray(e)){var t=e.length;document.getElementById("memosCount").innerHTML=t}})).catch((e=>{}))}window.onload=getTotal();var memo={host:"https://demo.usememos.com/",limit:"10",creatorId:"101",domId:"#memos"};if("undefined"!=typeof memos)for(var key in memos)memos[key]&&(memo[key]=memos[key]);var limit=memo.limit,memosHost=memo.host,localUrl="https://api.eallion.com/memos/memos.json",remoteUrl="https://api.eallion.com/memos/api/v1/memo?creatorId="+memo.creatorId+"&rowStatus=NORMAL",page=1,offset=10,nextLength=0,nextDom="",memoDom=document.querySelector(memo.domId),load='<button class="load-btn button-load">Loading……</button>';if(memoDom){memoDom.insertAdjacentHTML("afterend",load),getFirstList();var btn=document.querySelector("button.button-load");btn.addEventListener("click",(function(){btn.textContent="Loading......",updateHTMl(nextDom),nextLength<limit?document.querySelector("button.button-load").remove():getNextList()}))}function getFirstList(){var e=localUrl+"?t="+Date.parse(new Date);fetch(e).then((e=>e.json())).then((e=>{updateHTMl(e),e.length<limit?document.querySelector("button.button-load").remove():(page++,offset=limit*(page-1),getNextList())}))}function getNextList(){fetch(remoteUrl+"&limit="+limit+"&offset="+offset).then((e=>e.json())).then((e=>{nextLength=(nextDom=e).length,page++,offset=limit*(page-1),nextLength<1&&document.querySelector("button.button-load").remove()}))}async function updateHTMl(e){var t,o="";const a=/#((?:[^\s\p{P}]|_)+)/u,i=/\!\[(.*?)\]\((.*?)\)/g,n=/<a.*?href="https:\/\/music\.163\.com\/.*id=([0-9]+)".*?>.*<\/a>/g,s=/<a.*?href="https\:\/\/y\.qq\.com\/.*(\/[0-9a-zA-Z]+)(\.html)?".*?>.*?<\/a>/g,l=/<a.*?href="https:\/\/www\.bilibili\.com\/video\/((av[\d]{1,10})|(BV([\w]{10})))\/?".*?>.*<\/a>/g,m=/<a.*?href="https:\/\/www\.youtube\.com\/watch\?v\=([a-z|A-Z|0-9]{11})\".*?>.*<\/a>/g;marked.setOptions({breaks:!0,smartypants:!0,langPrefix:"language-",highlight:function(e,t){const o=hljs.getLanguage(t)?t:"plaintext";return hljs.highlight.toString(e,{language:o}).value}});const r=new marked.Renderer,c=r.link;r.link=(e,t,o)=>{const a=e.startsWith(`${location.protocol}//${location.hostname}`),i=c.call(r,e,t,o);return a?i:i.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')},marked.use({renderer:r});for(var d=0;d<e.length;d++){var u=e[d].id;let t="";if(e[d].relationList&&e[d].relationList.length>0){var p=e[d].relationList;await Promise.all(p.map((async e=>{var t=e.relatedMemoId;let o="";if(t){var a=await fetch("https://api.eallion.com/memos/api/v1/memo/"+t);const e=/\!\[(.*?)\]\((.*?)\)/g,i=/\[(.*?)\]\((.*?)\)/g;o=`<div class='relationList'><div class='relationWrapper'><div class='relationIcon'><i class='fas fa-paperclip fa-fw'></i></div><div class='relationContent'><a href='https://memos.eallion.com/m/${t}' target="_blank" rel="noopener noreferrer">${escapeHtml((await a.json()).content).replace(e,"").replace(i,'<a class="primary" href="$2" target="_blank">$1</a>')}</a></div></div></div>`}return o}))).then((e=>{t=e.join("")}))}var g=e[d].content.replace(a,"<span class='tag-span'>#$1</span> ").replace(i,"");g=marked.parse(g).replace(n,"<meting-js auto='https://music.163.com/#/song?id=$1'></meting-js>").replace(s,"<meting-js auto='https://y.qq.com/n/yqq/song$1.html'></meting-js>").replace(l,"<div class='video-wrapper'><iframe src='//www.bilibili.com/blackboard/html5mobileplayer.html?bvid=$1&as_wide=1&high_quality=1&danmaku=0' scrolling='no' border='0' frameborder='no' framespacing='0' allowfullscreen='true'></iframe></div>").replace(m,"<div class='video-wrapper'><div class='plyr__video-embed' id='plyr'><iframe src='https://www.youtube.com/embed/$1?origin=https://plyr.io&amp;iv_load_policy=3&amp;modestbranding=1&amp;playsinline=1&amp;showinfo=0&amp;rel=0&amp;enablejsapi=1' allowfullscreen allowtransparency></iframe></div></div>");memo.loadUrl;var v=e[d].content.match(i),f=String(v).replace(/[,]/g,"");if(v)g+='<div class="memos-image-wrapper">'+f.replace(i,'<div class="memos-images"><img loading="lazy" src="$2" alt="$2" view-image /></div>')+"</div>";if(e[d].resourceList&&e[d].resourceList.length>0){for(var h=e[d].resourceList,b="",w="",y=0,L=0;L<h.length;L++){var k=h[L].type.slice(0,5),S=h[L].externalLink,I="",x="";S?I=S:(x=h[L].publicId||h[L].filename,I=memos+"o/r/"+h[L].id+"/"+x),"image"==k&&(b+='<figure class="gallery-thumbnail"><img class="img thumbnail-image" src="'+I+'" alt="'+I+'" view-image /></figure>',y+=1),"image"!==k&&(w+='<a target="_blank" rel="noreferrer" href="'+I+'">'+h[L].filename+"</a>")}if(b){var _="";if(1!==y)_="grid grid-"+y;g+='<div class="resimg '+_+'">'+b+"</div>"}w&&(g+='<p class="datasource">'+w+"</p>")}o+='<li id="'+u+'" class="timeline"><div class="talks__content"><div class="talks__text"><div class="talks__userinfo"><div>Charles Chin</div><div><svg viewBox="0 0 24 24" aria-label="认证账号" class="talks__verify"><g><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .494.083.964.237 1.4-1.272.65-2.147 2.018-2.147 3.6 0 1.495.782 2.798 1.942 3.486-.02.17-.032.34-.032.514 0 2.21 1.708 4 3.818 4 .47 0 .92-.086 1.335-.25.62 1.334 1.926 2.25 3.437 2.25 1.512 0 2.818-.916 3.437-2.25.415.163.865.248 1.336.248 2.11 0 3.818-1.79 3.818-4 0-.174-.012-.344-.033-.513 1.158-.687 1.943-1.99 1.943-3.484zm-6.616-3.334l-4.334 6.5c-.145.217-.382.334-.625.334-.143 0-.288-.04-.416-.126l-.115-.094-2.415-2.415c-.293-.293-.293-.768 0-1.06s.768-.294 1.06 0l1.77 1.767 3.825-5.74c.23-.345.696-.436 1.04-.207.346.23.44.696.21 1.04z"></path></g></svg></div><div class="talks__id">@eallion · </div><small class="talks__date"><a href="https://memos.eallion.com/m/'+u+'" target="_blank">'+moment(1e3*e[d].createdTs).twitterLong()+"</a></small></div>"+g+t+'<div class="talks_comments"><a class="artalk-div" onclick="loadArtalk(\''+u+'\',event)"><i class="fas fa-comment-dots fa-fw"></i><span id="btn_memo_'+u+'">评论</span> (<span id="ArtalkCount" data-page-key="/m/'+u+'"></span>)</a></div><div id="memo_'+u+'" class="artalk hidden"></div></div></li>'}t='<ul class="talks">'+o+"</ul>",memoDom.insertAdjacentHTML("beforeend",t),initializeYoutubePlayer(),hljs.initHighlighting.called=!1,hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll(),Artalk.loadCountWidget({server:"https://api.eallion.com/artalk/",site:"memos",pvEl:"#ArtalkPV",countEl:"#ArtalkCount"});let M=document.querySelector("button.button-load");window.location.href.includes("/en/memos")?M.textContent="Load more":M.textContent="加载更多"}function escapeHtml(e){var t=document.createTextNode(e),o=document.createElement("div");return o.appendChild(t),o.innerHTML}let activeDiv=null;function loadArtalk(e,t){t.preventDefault();const o=document.getElementById("memo_"+e),a=document.getElementById("btn_memo_"+e),i=document.getElementById(e);if(o.classList.contains("hidden")){if(activeDiv){activeDiv.classList.add("hidden");const e=activeDiv.id.replace("memo_","btn_memo_");document.getElementById(e).innerHTML="评论"}o.classList.remove("hidden"),a.innerHTML='收起评论<i class="fas fa-level-up-alt"></i>',activeDiv=o;const t=new Artalk({el:"#memo_"+e,pageKey:"/m/"+e,pageTitle:"",server:"https://api.eallion.com/artalk/",site:"memos",darkMode:"auto"});function n(){const e=document.body.getAttribute("theme");t.setDarkMode("dark"===e)}n(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{n()}));const s=i.getBoundingClientRect().top+window.pageYOffset-3.5*parseFloat(getComputedStyle(document.documentElement).fontSize);window.scrollTo({top:s,behavior:"smooth"})}else o.classList.add("hidden"),a.innerHTML="评论",activeDiv=null}document.addEventListener("DOMContentLoaded",(()=>{let e=0;fetch("https://api.eallion.com/memos/api/v1/memo/all?rowStatus=NORMAL&tag=相册&limit=6").then((e=>e.json())).then((t=>{for(var o,a="",i=t,n=0;n<i.length;n++){var s=i[n].content.replace("#相册 ",""),l=(i[n].id,s.match(/\!\[(.*?)\s*(.*?)\]\((.*?)\)/g));l&&l.forEach((t=>{if(e<6){e++;let o,i,n=t.replace(/!\[.*?\]\((.*?)\)/g,"$1"),s=t.replace(/!\[(.*?)\]\(.*?\)/g,"$1");-1!=s.indexOf(" ")?(o=s.split(" ")[0],i=s.split(" ")[1]):i=s,a+=`<div class="memos-photo"><img class="photo-img" loading='lazy' decoding="async" src="${n}" alt="${i}" view-image />`,i&&(a+=`<a href="https://eallion.com/album/" target="_blank" rel="noreferrer noopener nofollow"><span class="photo-title">${i}</span></a>`),o&&(a+=`<span class="photo-time">${o}</span>`),a+="</div>"}}))}var m=document.querySelector("#gallery");o='<div class="memos-photo-wrapper">'+a+"</div>",m.innerHTML=o,window.Lately&&Lately.init({target:".photo-time"})}))}));var memosDom=document.querySelector("#memos"),editIcon=document.querySelector(".editIcon"),editorCont='<div class="memos-editor animate__animated animate__fadeIn d-none col-12"><div class="memos-editor-body mb-3 p-3"><div class="memos-editor-inner animate__animated animate__fadeIn"><div class="memos-editor-content"><textarea class="memos-editor-inputer text-sm" rows="1" placeholder="任何想法……"></textarea></div><div class="memos-editor-tools pt-3"><div class="d-flex"><div class="button outline action-btn tag-btn mr-2"><i class="fas fa-hashtag fa-sm"></i></div><div class="button outline action-btn todo-btn mr-2"><i class="fas fa-list fa-sm"></i></div><div class="button outline action-btn code-btn mr-2"><i class="fas fa-code fa-sm"></i></div><div class="button outline action-btn mr-2 link-btn"><i class="fas fa-link fa-sm"></i></div><div class="button outline action-btn image-btn" onclick="this.lastElementChild.click()"><i class="fas fa-images fa-sm"></i><input class="memos-upload-image-input d-none" type="file" accept="image/*"></div></div><div class="d-flex flex-fill"><div class="memos-tag-list d-none mt-2 animate__animated animate__fadeIn"></div></div></div><div class="memos-editor-footer border-t pt-3 mt-3"><div class="editor-selector mr-2"><select class="select-memos-value outline px-2 py-1"><option value="PUBLIC">所有人可见</option><option value="PROTECTED">仅登录可见</option><option value="PRIVATE">仅自己可见</option></select></div><div class="editor-submit d-flex flex-fill justify-content-end"><button class="primary submit-memos-btn px-3 py-1">记下</button></div></div></div><div class="memos-editor-option animate__animated animate__fadeIn"><input name="memos-api-url" class="memos-open-api-input input-text flex-fill mr-3 px-2 py-1" type="text" value="" maxlength="120" placeholder="输入 OpenAPI （仅保存在本地 localStorage）"><div class="memos-open-api-submit"><button class="primary submit-openapi-btn px-3 py-1">保存</button></div></div></div></div>';memosDom.insertAdjacentHTML("afterbegin",editorCont);var memosEditorInner=document.querySelector(".memos-editor-inner"),memosEditorOption=document.querySelector(".memos-editor-option"),taglistBtn=document.querySelector(".tag-btn"),todoBtn=document.querySelector(".todo-btn"),codeBtn=(todoBtn=document.querySelector(".todo-btn"),document.querySelector(".code-btn")),linkBtn=document.querySelector(".link-btn"),loadEditorBtn=document.querySelector(".load-memos-editor"),submitApiBtn=document.querySelector(".submit-openapi-btn"),submitMemoBtn=document.querySelector(".submit-memos-btn"),memosVisibilitySelect=document.querySelector(".select-memos-value"),memosTextarea=document.querySelector(".memos-editor-inputer"),openApiInput=document.querySelector(".memos-open-api-input"),uploadImageInput=document.querySelector(".memos-upload-image-input");function getEditIcon(){var e="",t="",o=[],a=window.localStorage&&window.localStorage.getItem("memos-access-path"),i=window.localStorage&&window.localStorage.getItem("memos-access-token"),n=window.localStorage&&window.localStorage.getItem("memos-editor-display"),s="hide"===n;function l(){if(i){memosEditorOption.classList.add("d-none"),cocoMessage.success("准备就绪");fetch(a+"/api/v1/tag?openId="+i).then((e=>e.json())).then((e=>e)).then((e=>{let t="";e.map((e=>{t+='<div class="memos-tag d-flex text-xs mt-2 mr-2"><a class="d-flex px-2 justify-content-center" onclick="setMemoTag(this)">#'+e+"</a></div>"})),document.querySelector(".memos-tag-list").insertAdjacentHTML("beforeend",t)})).catch((e=>cocoMessage.error("Memos Open API 有误，请重新输入!")))}else memosEditorInner.classList.add("d-none"),cocoMessage.info("请设置 Memos Open API")}memosTextarea.addEventListener("input",(e=>{memosTextarea.style.height="inherit",memosTextarea.style.height=e.target.scrollHeight+"px"})),null!==n&&(document.querySelector(".memos-editor").classList.toggle("d-none",s),"show"==n&&l()),loadEditorBtn.addEventListener("click",(function(){"show"!=n&&l(),document.querySelector(".memos-editor").classList.toggle("d-none"),window.localStorage&&window.localStorage.setItem("memos-editor-display",document.querySelector(".memos-editor").classList.contains("d-none")?"hide":"show"),n=window.localStorage&&window.localStorage.getItem("memos-editor-display")})),taglistBtn.addEventListener("click",(function(){i&&document.querySelector(".memos-tag-list").classList.toggle("d-none")})),todoBtn.addEventListener("click",(function(){if(i){let e="- [ ] ";memosTextarea.value+=e}})),codeBtn.addEventListener("click",(function(){if(i){let e="```\n\n```",t=memosTextarea.clientHeight;memosTextarea.value+=e,memosTextarea.style.height=3*t+"px"}})),linkBtn.addEventListener("click",(function(){if(i){let e="[]()";memosTextarea.value+=e}})),uploadImageInput.addEventListener("change",(()=>{let e=uploadImageInput.files[0];0!==uploadImageInput.files.length&&async function(e){const t=new FormData,n=a+"/api/v1/resource/blob?openId="+i;t.append("file",e,e.name);const s=await fetch(n,{method:"POST",body:t});await s.json().then((e=>{e.data.id&&cocoMessage.success("上传成功",(()=>{o.push(e.data.id),window.localStorage&&window.localStorage.setItem("memos-resource-list",JSON.stringify(o))}))}))}(e)})),submitApiBtn.addEventListener("click",(function(){!function(e){let t=/openId=([^&]*)/,o=/(.+?)(?:\/api)/;fetch(e).then((n=>{if(200==n.status){let n=e.match(t),s=e.match(o)[1];i=n[1],a=s,window.localStorage&&window.localStorage.setItem("memos-access-path",s),window.localStorage&&window.localStorage.setItem("memos-access-token",i),cocoMessage.success("保存成功",(()=>{memosEditorOption.classList.add("d-none"),memosEditorInner.classList.remove("d-none"),a=window.localStorage&&window.localStorage.getItem("memos-access-path"),i=window.localStorage&&window.localStorage.getItem("memos-access-token"),l()}))}else cocoMessage.error("出错了，再检查一下吧!")})).catch((e=>{cocoMessage.error("网络错误")}))}(openApiInput.value)})),submitMemoBtn.addEventListener("click",(function(){e=memosTextarea.value,t=memosVisibilitySelect.value,o=window.localStorage&&JSON.parse(window.localStorage.getItem("memos-resource-list"));let n=0!==e.length;if(i&&n){let n={content:e,visibility:t,resourceIdList:o};fetch(a+"/api/v1/memo?openId="+i,{method:"post",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((function(e){200==e.status&&cocoMessage.success("发送成功",(()=>{location.reload()}))}))}else cocoMessage.info("内容不能为空")}))}function setMemoTag(e){let t=e.textContent+" ";memosTextarea.value+=t}function initializeYoutubePlayer(){new Plyr("#plyr",{noCookie:!1,rel:0,showinfo:0,iv_load_policy:3,modestbranding:1})}document.addEventListener("DOMContentLoaded",(()=>{getEditIcon()}));