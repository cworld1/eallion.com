window.location.href.includes("/en/memos")?fetch("https://api.github.com/zen").then((e=>e.text())).then((e=>{document.querySelector("#hitokoto").innerText=e;document.querySelector("#author").innerText="GitHub Zen"})).catch(console.error):fetch("https://api.eallion.com/hitokoto?c=k&charset=utf-8&encode=json").then((e=>e.json())).then((e=>{document.querySelector("#hitokoto").innerText=e.hitokoto;const t=document.querySelector("#author");e.from_who?t.innerText=e.from_who:t.innerText=e.from})).catch(console.error);var memo={host:"https://demo.usememos.com/",limit:"10",creatorId:"101",domId:"#memos"};if("undefined"!=typeof memos)for(var key in memos)memos[key]&&(memo[key]=memos[key]);var limit=memo.limit,memosHost=memo.host,localUrl="https://api.eallion.com/memos/memos.json",remoteUrl="https://api.eallion.com/memos/api/v1/memo?creatorId="+memo.creatorId+"&rowStatus=NORMAL",page=1,offset=10,nextLength=0,nextDom="",memoDom=document.querySelector(memo.domId),load='<button class="load-btn button-load">Loading……</button>';if(memoDom){memoDom.insertAdjacentHTML("afterend",load),getFirstList();var btn=document.querySelector("button.button-load");btn.addEventListener("click",(function(){btn.textContent="Loading......",updateHTMl(nextDom),nextLength<limit?document.querySelector("button.button-load").remove():getNextList()}))}function getFirstList(){var e=localUrl+"?t="+Date.parse(new Date);fetch(e).then((e=>e.json())).then((e=>{updateHTMl(e),e.length<limit?document.querySelector("button.button-load").remove():(page++,offset=limit*(page-1),getNextList())}))}function getNextList(){fetch(remoteUrl+"&limit="+limit+"&offset="+offset).then((e=>e.json())).then((e=>{nextLength=(nextDom=e).length,page++,offset=limit*(page-1),nextLength<1&&document.querySelector("button.button-load").remove()}))}async function updateHTMl(e){var t,a="";const o=/#((?:[^\s\p{P}]|_)+)/u,i=/\!\[(.*?)\]\((.*?)\)/g,n=/<a.*?href="https:\/\/music\.163\.com\/.*id=([0-9]+)".*?>.*<\/a>/g,l=/<a.*?href="https\:\/\/y\.qq\.com\/.*(\/[0-9a-zA-Z]+)(\.html)?".*?>.*?<\/a>/g,r=/<a.*?href="https:\/\/www\.bilibili\.com\/video\/((av[\d]{1,10})|(BV([\w]{10})))\/?".*?>.*<\/a>/g,s=/<a.*?href="https:\/\/www\.youtube\.com\/watch\?v\=([a-z|A-Z|0-9]{11})\".*?>.*<\/a>/g;marked.setOptions({breaks:!0,smartypants:!0,langPrefix:"language-",highlight:function(e,t){const a=hljs.getLanguage(t)?t:"plaintext";return hljs.highlight.toString(e,{language:a}).value}});const m=new marked.Renderer,c=m.link;m.link=(e,t,a)=>{const o=e.startsWith(`${location.protocol}//${location.hostname}`),i=c.call(m,e,t,a);return o?i:i.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')},marked.use({renderer:m});for(var d=0;d<e.length;d++){var p=e[d].id;let t="";if(e[d].relationList&&e[d].relationList.length>0){var h=e[d].relationList;await Promise.all(h.map((async e=>{var t=e.relatedMemoId;let a="";if(t){var o=await fetch("https://api.eallion.com/memos/api/v1/memo/"+t);const e=/\!\[(.*?)\]\((.*?)\)/g,i=/\[(.*?)\]\((.*?)\)/g;a=`<div class='relationList'><div class='relationWrapper'><div class='relationIcon'><i class='fas fa-paperclip fa-fw'></i></div><div class='relationContent'><a href='https://memos.eallion.com/m/${t}' target="_blank" rel="noopener noreferrer">${escapeHtml((await o.json()).content).replace(e,"").replace(i,'<a class="primary" href="$2" target="_blank">$1</a>')}</a></div></div></div>`}return a}))).then((e=>{t=e.join("")}))}var u=e[d].content.replace(o,"<span class='tag-span'>#$1</span> ").replace(i,"");u=marked.parse(u).replace(n,"<meting-js auto='https://music.163.com/#/song?id=$1'></meting-js>").replace(l,"<meting-js auto='https://y.qq.com/n/yqq/song$1.html'></meting-js>").replace(r,"<div class='video-wrapper'><iframe src='//www.bilibili.com/blackboard/html5mobileplayer.html?bvid=$1&as_wide=1&high_quality=1&danmaku=0' scrolling='no' border='0' frameborder='no' framespacing='0' allowfullscreen='true'></iframe></div>").replace(s,"<div class='video-wrapper'><div class='plyr__video-embed' id='plyr'><iframe src='https://www.youtube.com/embed/$1?origin=https://plyr.io&amp;iv_load_policy=3&amp;modestbranding=1&amp;playsinline=1&amp;showinfo=0&amp;rel=0&amp;enablejsapi=1' allowfullscreen allowtransparency></iframe></div></div>");memo.loadUrl;var g=e[d].content.match(i),v=String(g).replace(/[,]/g,"");if(g)u+='<div class="memos-image-wrapper">'+v.replace(i,'<div class="memos-images" view-image><img loading="lazy" src="$2" alt="$2" /></div>')+"</div>";if(e[d].resourceList&&e[d].resourceList.length>0){for(var f=e[d].resourceList,b="",w="",y=0,k=0;k<f.length;k++){var L=f[k].type.slice(0,5),_=f[k].externalLink,x="",j="";_?x=_:(j=f[k].publicId||f[k].filename,x=memos+"o/r/"+f[k].id+"/"+j),"image"==L&&(b+='<figure class="gallery-thumbnail"><img class="img thumbnail-image" src="'+x+'" alt="'+x+'" /></figure>',y+=1),"image"!==L&&(w+='<a target="_blank" rel="noreferrer" href="'+x+'">'+f[k].filename+"</a>")}if(b){var T="";if(1!==y)T="grid grid-"+y;u+='<div class="resimg '+T+'">'+b+"</div>"}w&&(u+='<p class="datasource">'+w+"</p>")}a+='<li id="'+p+'" class="timeline"><div class="talks__content"><div class="talks__text"><div class="talks__userinfo"><div>Charles Chin</div><div><svg viewBox="0 0 24 24" aria-label="认证账号" class="talks__verify"><g><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .494.083.964.237 1.4-1.272.65-2.147 2.018-2.147 3.6 0 1.495.782 2.798 1.942 3.486-.02.17-.032.34-.032.514 0 2.21 1.708 4 3.818 4 .47 0 .92-.086 1.335-.25.62 1.334 1.926 2.25 3.437 2.25 1.512 0 2.818-.916 3.437-2.25.415.163.865.248 1.336.248 2.11 0 3.818-1.79 3.818-4 0-.174-.012-.344-.033-.513 1.158-.687 1.943-1.99 1.943-3.484zm-6.616-3.334l-4.334 6.5c-.145.217-.382.334-.625.334-.143 0-.288-.04-.416-.126l-.115-.094-2.415-2.415c-.293-.293-.293-.768 0-1.06s.768-.294 1.06 0l1.77 1.767 3.825-5.74c.23-.345.696-.436 1.04-.207.346.23.44.696.21 1.04z"></path></g></svg></div><div class="talks__id">@eallion · </div><small class="talks__date"><a href="https://memos.eallion.com/m/'+p+'" target="_blank">'+moment(1e3*e[d].createdTs).twitterLong()+"</a></small></div>"+u+t+'<div class="talks_comments"><a class="artalk-div" onclick="loadArtalk(\''+p+'\',event)"><i class="fas fa-comment-dots fa-fw"></i><span id="btn_memo_'+p+'">评论</span> (<span id="ArtalkCount" data-page-key="/m/'+p+'"></span>)</a></div><div id="memo_'+p+'" class="artalk hidden"></div></div></li>'}t='<ul class="talks">'+a+"</ul>",memoDom.insertAdjacentHTML("beforeend",t),initializeYoutubePlayer(),hljs.initHighlighting.called=!1,hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll(),Artalk.loadCountWidget({server:"https://api.eallion.com/artalk/",site:"memos",pvEl:"#ArtalkPV",countEl:"#ArtalkCount"});let M=document.querySelector("button.button-load");window.location.href.includes("/en/memos")?M.textContent="Load more":M.textContent="加载更多"}function escapeHtml(e){var t=document.createTextNode(e),a=document.createElement("div");return a.appendChild(t),a.innerHTML}let activeDiv=null;function loadArtalk(e,t){t.preventDefault();const a=document.getElementById("memo_"+e),o=document.getElementById("btn_memo_"+e),i=document.getElementById(e);if(a.classList.contains("hidden")){if(activeDiv){activeDiv.classList.add("hidden");const e=activeDiv.id.replace("memo_","btn_memo_");document.getElementById(e).innerHTML="评论"}a.classList.remove("hidden"),o.innerHTML='收起评论<i class="fas fa-level-up-alt"></i>',activeDiv=a;const t=new Artalk({el:"#memo_"+e,pageKey:"/m/"+e,pageTitle:"",server:"https://api.eallion.com/artalk/",site:"memos",darkMode:"auto"});function n(){const e=document.body.getAttribute("theme");t.setDarkMode("dark"===e)}n(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{n()}));const l=i.getBoundingClientRect().top+window.pageYOffset-3.5*parseFloat(getComputedStyle(document.documentElement).fontSize);window.scrollTo({top:l,behavior:"smooth"})}else a.classList.add("hidden"),o.innerHTML="评论",activeDiv=null}function initializeYoutubePlayer(){new Plyr("#plyr",{noCookie:!1,rel:0,showinfo:0,iv_load_policy:3,modestbranding:1})}document.addEventListener("DOMContentLoaded",(()=>{let e=0;fetch("https://api.eallion.com/memos/api/v1/memo/all?rowStatus=NORMAL&tag=相册&limit=6").then((e=>e.json())).then((t=>{for(var a,o="",i=t,n=0;n<i.length;n++){var l=i[n].content.replace("#相册 ",""),r=(i[n].id,l.match(/\!\[(.*?)\s*(.*?)\]\((.*?)\)/g));r&&r.forEach((t=>{if(e<6){e++;let a,i,n=t.replace(/!\[.*?\]\((.*?)\)/g,"$1"),l=t.replace(/!\[(.*?)\]\(.*?\)/g,"$1");-1!=l.indexOf(" ")?(a=l.split(" ")[0],i=l.split(" ")[1]):i=l,o+=`<div class="memos-photo"><img class="photo-img" loading='lazy' decoding="async" src="${n}" alt="${i}" />`,i&&(o+=`<a href="https://eallion.com/album/" target="_blank" rel="noreferrer noopener nofollow"><span class="photo-title">${i}</span></a>`),a&&(o+=`<span class="photo-time">${a}</span>`),o+="</div>"}}))}var s=document.querySelector("#gallery");a='<div class="memos-photo-wrapper" view-image>'+o+"</div>",s.innerHTML=a,window.Lately&&Lately.init({target:".photo-time"})}))}));