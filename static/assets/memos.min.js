function getTotal(){fetch("https://api.eallion.com/memos/api/memo/stats?creatorId=101").then((e=>e.json())).then((e=>{if(e.data){var t=e.data.length;document.getElementById("memosCount").innerHTML=t}})).catch((e=>{}))}window.onload=getTotal();var memo={host:"https://demo.usememos.com/",limit:"10",creatorId:"101",domId:"#memos"};if(void 0!==memos)for(var key in memos)memos[key]&&(memo[key]=memos[key]);var limit=memo.limit,memos=memo.host,localUrl="https://api.eallion.com/memos/memos.json",remoteUrl="https://api.eallion.com/memos/api/memo?creatorId="+memo.creatorId+"&rowStatus=NORMAL",page=1,offset=10,nextLength=0,nextDom="",memoDom=document.querySelector(memo.domId),load='<button class="load-btn button-load">努力加载中……</button>';if(memoDom){memoDom.insertAdjacentHTML("afterend",load),getFirstList();var btn=document.querySelector("button.button-load");btn.addEventListener("click",(function(){btn.textContent="努力加载中……",updateHTMl(nextDom),nextLength<limit?document.querySelector("button.button-load").remove():getNextList()}))}function getFirstList(){var e=localUrl+"?t="+Date.parse(new Date);fetch(e).then((e=>e.json())).then((e=>{updateHTMl(e.data),e.data.length<limit?document.querySelector("button.button-load").remove():(page++,offset=limit*(page-1),getNextList())}))}function getNextList(){fetch(remoteUrl+"&limit="+limit+"&offset="+offset).then((e=>e.json())).then((e=>{nextDom=e.data,nextLength=nextDom.length,page++,offset=limit*(page-1),nextLength<1&&document.querySelector("button.button-load").remove()}))}function updateHTMl(e){var t,a="";const o=/#([^\s#]+)/,i=/<a\shref="https:\/\/music\.163\.com\/.*id=([0-9]+)".*?>.*<\/a>/g,r=/<a\shref="https\:\/\/y\.qq\.com\/.*(\/[0-9a-zA-Z]+)(\.html)?".*?>.*?<\/a>/g,l=/<a\shref="https:\/\/open\.spotify\.com\/(track|album)\/([\s\S]+)".*?>.*<\/a>/g;marked.setOptions({breaks:!0,smartypants:!0,langPrefix:"language-",highlight:function(e,t){const a=hljs.getLanguage(t)?t:"plaintext";return hljs.highlight.toString(e,{language:a}).value}});const s=new marked.Renderer,n=s.link;s.link=(e,t,a)=>{const o=e.startsWith(`${location.protocol}//${location.hostname}`),i=n.call(s,e,t,a);return o?i:i.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')},marked.use({renderer:s});for(var m=0;m<e.length;m++){var c=e[m].content.replace(o,"<span class='tag-span'><a>$1</a></span> ");if(c=marked.parse(c).replace(i,"<meting-js auto='https://music.163.com/#/song?id=$1'></meting-js>").replace(r,"<meting-js auto='https://y.qq.com/n/yqq/song$1.html'></meting-js>").replace(l,"<div class='spotify-wrapper'><iframe style='border-radius:12px' src='https://open.spotify.com/embed/$1/$2?utm_source=generator&theme=0' width='100%' frameBorder='0' allowfullscreen='' allow='autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture' loading='lazy'></iframe></div>"),e[m].resourceList&&e[m].resourceList.length>0){for(var d=e[m].resourceList,g="",p="",h=0,v=0;v<d.length;v++){var u=d[v].type.slice(0,5);"image"==u&&(g+='<img loading="lazy" src="'+memos+"o/r/"+d[v].id+"/"+d[v].filename+'"/>',h+=1),"image"!==u&&(p+='<a target="_blank" rel="noreferrer" href="'+memos+"o/r/"+d[v].id+"/"+d[v].filename+'">'+d[v].filename+"</a>")}if(g){var f="";if(1!==h)f="grid grid-"+h;c+='<div class="resimg '+f+'">'+g+"</div>"}p&&(c+='<p class="datasource">'+p+"</p>")}a+='<li id="'+e[m].id+'" class="timeline"><div class="talks__content"><div class="talks__text"><div class="talks__userinfo"><div>Charles Chin</div><div><svg viewBox="0 0 24 24" aria-label="认证账号" class="talks__verify"><g><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .494.083.964.237 1.4-1.272.65-2.147 2.018-2.147 3.6 0 1.495.782 2.798 1.942 3.486-.02.17-.032.34-.032.514 0 2.21 1.708 4 3.818 4 .47 0 .92-.086 1.335-.25.62 1.334 1.926 2.25 3.437 2.25 1.512 0 2.818-.916 3.437-2.25.415.163.865.248 1.336.248 2.11 0 3.818-1.79 3.818-4 0-.174-.012-.344-.033-.513 1.158-.687 1.943-1.99 1.943-3.484zm-6.616-3.334l-4.334 6.5c-.145.217-.382.334-.625.334-.143 0-.288-.04-.416-.126l-.115-.094-2.415-2.415c-.293-.293-.293-.768 0-1.06s.768-.294 1.06 0l1.77 1.767 3.825-5.74c.23-.345.696-.436 1.04-.207.346.23.44.696.21 1.04z"></path></g></svg></div><div class="talks__id">@eallion · </div><small class="talks__date"><a href="https://memos.eallion.com/m/'+e[m].id+'" target="_blank">'+moment(1e3*e[m].createdTs).twitterLong()+"</a></small></div><p>"+c+"</p></div></div></li>"}t='<ul class="talks">'+a+"</ul>",memoDom.insertAdjacentHTML("beforeend",t),fetchDB(),hljs.initHighlighting.called=!1,hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll(),lightGallery(document.getElementById("lightgallery")),document.querySelector("button.button-load").textContent="加载更多"}function fetchDB(){var e="https://api.eallion.com/douban/",t=document.querySelectorAll(".timeline a[href*='douban.com/subject/']:not([rel='noreferrer'])")||"";if(t)for(var a=0;a<t.length;a++){_this=t[a];var o=_this.href,i=/^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/,r=o.replace(i,"$1"),l=o.replace(i,"$2").toString();if("movie"==r){var s="movie"+l,n=e+"movies/"+l;null==localStorage.getItem(s)||"undefined"==localStorage.getItem(s)?fetch(n).then((e=>e.json())).then((e=>{let t="movies"+e.sid,a="https://movie.douban.com/subject/"+e.sid+"/";localStorage.setItem(t,JSON.stringify(e)),movieShow(a,t)})):movieShow(o,s)}else if("book"==r){s="book"+l,n=e+"v2/book/id/"+l;null==localStorage.getItem(s)||"undefined"==localStorage.getItem(s)?fetch(n).then((e=>e.json())).then((e=>{let t="book"+e.id,a="https://book.douban.com/subject/"+e.id+"/";localStorage.setItem(t,JSON.stringify(e)),bookShow(a,t)})):bookShow(o,s)}}}function movieShow(e,t){var a=localStorage.getItem(t),o=JSON.parse(a),i=Math.ceil(o.rating),r="<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' rel='noreferrer' href='"+e+"'>《"+o.name+"》</a></h4><div class='rating'><div class='rating-star allstar"+i+"'></div><div class='rating-average'>"+o.rating+"</div></div><time class='post-preview--date'>导演："+o.director+" / 类型："+o.genre+" / "+o.year+"</time><section class='post-preview--excerpt'>"+o.intro.replace(/\s*/g,"")+"</section></div></div><img referrer-policy='no-referrer' loading='lazy' class='post-preview--image' src="+o.img+"></div>",l=document.createElement("div"),s=".timeline a[href='"+e+"']",n=document.querySelector(s);n.parentNode.replaceChild(l,n),l.innerHTML=r}function bookShow(e,t){var a=localStorage.getItem(t),o=JSON.parse(a),i=Math.ceil(o.rating.average),r="<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' rel='noreferrer' href='"+e+"'>《"+o.title+"》</a></h4><div class='rating'><div class='rating-star allstar"+i+"'></div><div class='rating-average'>"+o.rating.average+"</div></div><time class='post-preview--date'>作者："+o.author+" </time><section class='post-preview--excerpt'>"+o.summary.replace(/\s*/g,"")+"</section></div></div><img referrer-policy='no-referrer' loading='lazy' class='post-preview--image' src="+o.images.medium+"></div>",l=document.createElement("div"),s=".timeline a[href='"+e+"']",n=document.querySelector(s);n.parentNode.replaceChild(l,n),l.innerHTML=r}document.addEventListener("DOMContentLoaded",(()=>{let e=0;fetch("https://api.eallion.com/memos/api/memo/all?rowStatus=NORMAL&tag=相册&limit=6").then((e=>e.json())).then((t=>{for(var a,o="",i=t.data,r=0;r<i.length;r++){var l=i[r].content.replace("#相册 ",""),s=i[r].id,n=l.match(/\!\[(.*?)\s*(.*?)\]\((.*?)\)/g);n&&n.forEach((t=>{if(e<6){e++;let a,i,r=t.replace(/!\[.*?\]\((.*?)\)/g,"$1"),l=t.replace(/!\[(.*?)\]\(.*?\)/g,"$1");-1!=l.indexOf(" ")?(a=l.split(" ")[0],i=l.split(" ")[1]):i=l,o+=`<div class="memos-photo"><img class="photo-img" loading='lazy' decoding="async" src="${r}"></a>`,i&&(o+=`<a href="https://memos.eallion.com/m/${s}" target="_blank" rel="noreferrer noopener nofollow"><span class="photo-title">${i}</span></a>`),a&&(o+=`<span class="photo-time">${a}</span>`),o+="</div>"}}))}var m=document.querySelector("#album");a='<div class="memos-photo-wrapper">'+o+"</div>",m.innerHTML=a,window.Lately&&Lately.init({target:".photo-time"})}))})),document.addEventListener("DOMContentLoaded",(()=>{pangu.autoSpacingPage()}));