function getTotal(){var e="https://api.eallion.com/memos/api/memo/stats?creatorId=101";fetch(e).then(e=>e.json()).then(e=>{if(e.data){var t=e.data.length,o=document.getElementById("memosCount");o.innerHTML=t}}).catch(e=>{})}function getFirstList(){var e=localUrl+"?t="+Date.parse(new Date);fetch(e).then(e=>e.json()).then(e=>{updateHTMl(e.data);var t=e.data.length;t<limit?document.querySelector("button.button-load").remove():(page++,offset=limit*(page-1),getNextList())})}function getNextList(){var e=remoteUrl+"&limit="+limit+"&offset="+offset;fetch(e).then(e=>e.json()).then(e=>{nextDom=e.data,nextLength=nextDom.length,page++,offset=limit*(page-1),nextLength<1&&document.querySelector("button.button-load").remove()})}function updateHTMl(e){var t="",o="";const a=/#([^\s#]+)/,i=/\!\[(.*?)\]\((.*?)\)/g,n=/<a.*?href="https:\/\/music\.163\.com\/.*id=([0-9]+)".*?>.*<\/a>/g,s=/<a.*?href="https\:\/\/y\.qq\.com\/.*(\/[0-9a-zA-Z]+)(\.html)?".*?>.*?<\/a>/g,l=/<a.*?href="https:\/\/www\.bilibili\.com\/video\/((av[\d]{1,10})|(BV([\w]{10})))\/?".*?>.*<\/a>/g,r=/<a.*?href="https:\/\/www\.youtube\.com\/watch\?v\=([a-z|A-Z|0-9]{11})\".*?>.*<\/a>/g;marked.setOptions({breaks:!0,smartypants:!0,langPrefix:"language-",highlight:function(e,t){const o=hljs.getLanguage(t)?t:"plaintext";return hljs.highlight.toString(e,{language:o}).value}});const m=new marked.Renderer,c=m.link;m.link=((e,t,o)=>{const a=e.startsWith(`${location.protocol}//${location.hostname}`),i=c.call(m,e,t,o);return a?i:i.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')}),marked.use({renderer:m});for(var d=0;d<e.length;d++){var u=e[d].id,p=e[d].content.replace(a,"<span class='tag-span'>#$1</span> ").replace(i,"");p=marked.parse(p).replace(n,"<meting-js auto='https://music.163.com/#/song?id=$1'></meting-js>").replace(s,"<meting-js auto='https://y.qq.com/n/yqq/song$1.html'></meting-js>").replace(l,"<div class='video-wrapper'><iframe src='//www.bilibili.com/blackboard/html5mobileplayer.html?bvid=$1&as_wide=1&high_quality=1&danmaku=0' scrolling='no' border='0' frameborder='no' framespacing='0' allowfullscreen='true'></iframe></div>").replace(r,"<div class='video-wrapper'><div class='plyr__video-embed' id='plyr'><iframe src='https://www.youtube.com/embed/$1?origin=https://plyr.io&amp;iv_load_policy=3&amp;modestbranding=1&amp;playsinline=1&amp;showinfo=0&amp;rel=0&amp;enablejsapi=1' allowfullscreen allowtransparency></iframe></div></div>");memo.loadUrl;var g=e[d].content.match(i),v=String(g).replace(/[,]/g,"");if(g){var h=v.replace(i,'<div class="memos-images"><img loading="lazy" src="$2" data-action="zoom"></div>');p+='<div class="memos-image-wrapper">'+h+"</div>"}if(e[d].resourceList&&e[d].resourceList.length>0){for(var f=e[d].resourceList,b="",w="",y=0,S=0;S<f.length;S++){var k=f[S].type.slice(0,5),I=f[S].externalLink,L="",x="";I?L=I:(x=f[S].publicId||f[S].filename,L=memos+"o/r/"+f[S].id+"/"+x),"image"==k&&(b+='<figure class="gallery-thumbnail"><img class="img thumbnail-image" src="'+L+'"  data-action="zoom"/></figure>',y+=1),"image"!==k&&(w+='<a target="_blank" rel="noreferrer" href="'+L+'">'+f[S].filename+"</a>")}if(b){var _="";if(1!==y)_="grid grid-"+y;p+='<div class="resimg '+_+'">'+b+"</div>"}w&&(p+='<p class="datasource">'+w+"</p>")}var M='<svg viewBox="0 0 24 24" aria-label="认证账号" class="talks__verify"><g><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .494.083.964.237 1.4-1.272.65-2.147 2.018-2.147 3.6 0 1.495.782 2.798 1.942 3.486-.02.17-.032.34-.032.514 0 2.21 1.708 4 3.818 4 .47 0 .92-.086 1.335-.25.62 1.334 1.926 2.25 3.437 2.25 1.512 0 2.818-.916 3.437-2.25.415.163.865.248 1.336.248 2.11 0 3.818-1.79 3.818-4 0-.174-.012-.344-.033-.513 1.158-.687 1.943-1.99 1.943-3.484zm-6.616-3.334l-4.334 6.5c-.145.217-.382.334-.625.334-.143 0-.288-.04-.416-.126l-.115-.094-2.415-2.415c-.293-.293-.293-.768 0-1.06s.768-.294 1.06 0l1.77 1.767 3.825-5.74c.23-.345.696-.436 1.04-.207.346.23.44.696.21 1.04z"></path></g></svg>';t+='<li id="'+u+'" class="timeline"><div class="talks__content"><div class="talks__text"><div class="talks__userinfo"><div>Charles Chin</div><div>'+M+'</div><div class="talks__id">@eallion · </div><small class="talks__date"><a href="https://memos.eallion.com/m/'+u+'" target="_blank">'+moment(1e3*e[d].createdTs).twitterLong()+"</a></small></div>"+p+"<div class='talks_comments'><a class='artalk-div' onclick=\"loadArtalk('"+u+"',event)\"><i class='fas fa-comment-dots fa-fw'></i><span id='btn_memo_"+u+"'>评论</span> (<span id='ArtalkCount' data-page-key='/m/"+u+"'>0</span>)</a></div><div id='memo_"+u+"' class='artalk hidden'></div></div></li>"}var q='<ul class="talks">',T="</ul>";o=q+t+T,memoDom.insertAdjacentHTML("beforeend",o),fetchDB(),initializeYoutubePlayer(),hljs.initHighlighting.called=!1,hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll(),document.querySelector("button.button-load").textContent="加载更多"}function loadArtalk(e,t){t.preventDefault();const o=document.getElementById("memo_"+e),a=document.getElementById("btn_memo_"+e),i=document.getElementById(e);if(o.classList.contains("hidden")){if(activeDiv){activeDiv.classList.add("hidden");const e=activeDiv.id.replace("memo_","btn_memo_"),t=document.getElementById(e);t.innerHTML="评论"}o.classList.remove("hidden"),a.innerHTML='收起评论<i class="fas fa-level-up-alt"></i>',activeDiv=o;const t=new Artalk({el:"#memo_"+e,pageKey:"/m/"+e,pageTitle:"",server:"https://api.eallion.com/artalk/",site:"memos",darkMode:"auto"});function n(){const e=document.body.getAttribute("theme");t.setDarkMode("dark"===e)}n(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{n()});const s=i.getBoundingClientRect().top+window.pageYOffset,l=s-3.5*parseFloat(getComputedStyle(document.documentElement).fontSize);window.scrollTo({top:l,behavior:"smooth"})}else o.classList.add("hidden"),a.innerHTML="评论",activeDiv=null}function fetchDB(){var e="https://api.eallion.com/douban/",t=document.querySelectorAll(".timeline a[href*='douban.com/subject/']:not([rel='noreferrer'])")||"";if(t)for(var o=0;o<t.length;o++){_this=t[o];var a=_this.href,i=/^https\:\/\/(movie|book)\.douban\.com\/subject\/([0-9]+)\/?/,n=a.replace(i,"$1"),s=a.replace(i,"$2").toString();if("movie"==n){var l="movie"+s,r=e+"movies/"+s;null==localStorage.getItem(l)||"undefined"==localStorage.getItem(l)?fetch(r).then(e=>e.json()).then(e=>{let t="movies"+e.sid,o="https://movie.douban.com/subject/"+e.sid+"/";localStorage.setItem(t,JSON.stringify(e)),movieShow(o,t)}):movieShow(a,l)}else if("book"==n){l="book"+s,r=e+"v2/book/id/"+s;null==localStorage.getItem(l)||"undefined"==localStorage.getItem(l)?fetch(r).then(e=>e.json()).then(e=>{let t="book"+e.id,o="https://book.douban.com/subject/"+e.id+"/";localStorage.setItem(t,JSON.stringify(e)),bookShow(o,t)}):bookShow(a,l)}}}function movieShow(e,t){var o=localStorage.getItem(t),a=JSON.parse(o),i=Math.ceil(a.rating),n="<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' rel='noreferrer' href='"+e+"'>《"+a.name+"》</a></h4><div class='rating'><div class='rating-star allstar"+i+"'></div><div class='rating-average'>"+a.rating+"</div></div><time class='post-preview--date'>导演："+a.director+" / 类型："+a.genre+" / "+a.year+"</time><section class='post-preview--excerpt'>"+a.intro.replace(/\s*/g,"")+"</section></div></div></div>",s=document.createElement("div"),l=".timeline a[href='"+e+"']",r=document.querySelector(l);r.parentNode.replaceChild(s,r),s.innerHTML=n}function bookShow(e,t){var o=localStorage.getItem(t),a=JSON.parse(o),i=Math.ceil(a.rating.average),n="<div class='post-preview'><div class='post-preview--meta'><div class='post-preview--middle'><h4 class='post-preview--title'><a target='_blank' rel='noreferrer' href='"+e+"'>《"+a.title+"》</a></h4><div class='rating'><div class='rating-star allstar"+i+"'></div><div class='rating-average'>"+a.rating.average+"</div></div><time class='post-preview--date'>作者："+a.author+" </time><section class='post-preview--excerpt'>"+a.summary.replace(/\s*/g,"")+"</section></div></div></div>",s=document.createElement("div"),l=".timeline a[href='"+e+"']",r=document.querySelector(l);r.parentNode.replaceChild(s,r),s.innerHTML=n}function getEditIcon(){async function e(e){const t=new FormData,o=s+"/api/resource/blob?openId="+l;t.append("file",e,e.name);const a=await fetch(o,{method:"POST",body:t});await a.json().then(e=>{e.data.id&&cocoMessage.success("上传成功",()=>{n.push(e.data.id),window.localStorage&&window.localStorage.setItem("memos-resource-list",JSON.stringify(n))})})}function t(){if(l){memosEditorOption.classList.add("d-none"),cocoMessage.success("准备就绪");let e=s+"/api/tag?openId="+l;fetch(e).then(e=>e.json()).then(e=>e.data).then(e=>{let t="";e.map(e=>{t+='<div class="memos-tag d-flex text-xs mt-2 mr-2"><a class="d-flex px-2 justify-content-center" onclick="setMemoTag(this)">#'+e+"</a></div>"}),document.querySelector(".memos-tag-list").insertAdjacentHTML("beforeend",t)}).catch(e=>cocoMessage.error("Memos Open API 有误，请重新输入!"))}else memosEditorInner.classList.add("d-none"),cocoMessage.info("请设置 Memos Open API")}function o(e){let o=/openId=([^&]*)/,a=/(.+?)(?:\/api)/;fetch(e).then(i=>{if(200==i.status){let i=e.match(o),n=e.match(a)[1];l=i[1],s=n,window.localStorage&&window.localStorage.setItem("memos-access-path",n),window.localStorage&&window.localStorage.setItem("memos-access-token",l),cocoMessage.success("保存成功",()=>{memosEditorOption.classList.add("d-none"),memosEditorInner.classList.remove("d-none"),s=window.localStorage&&window.localStorage.getItem("memos-access-path"),l=window.localStorage&&window.localStorage.getItem("memos-access-token"),t()})}else cocoMessage.error("出错了，再检查一下吧!")}).catch(e=>{cocoMessage.error("网络错误")})}var a="",i="",n=[],s=window.localStorage&&window.localStorage.getItem("memos-access-path"),l=window.localStorage&&window.localStorage.getItem("memos-access-token"),r=window.localStorage&&window.localStorage.getItem("memos-editor-display"),m="hide"===r;memosTextarea.addEventListener("input",e=>{memosTextarea.style.height="inherit",memosTextarea.style.height=e.target.scrollHeight+"px"}),null!==r&&(document.querySelector(".memos-editor").classList.toggle("d-none",m),"show"==r&&t()),loadEditorBtn.addEventListener("click",function(){"show"!=r&&t(),document.querySelector(".memos-editor").classList.toggle("d-none"),window.localStorage&&window.localStorage.setItem("memos-editor-display",document.querySelector(".memos-editor").classList.contains("d-none")?"hide":"show"),r=window.localStorage&&window.localStorage.getItem("memos-editor-display")}),taglistBtn.addEventListener("click",function(){l&&document.querySelector(".memos-tag-list").classList.toggle("d-none")}),todoBtn.addEventListener("click",function(){if(l){let e="- [ ] ";memosTextarea.value+=e}}),codeBtn.addEventListener("click",function(){if(l){let e="```\n\n```",t=memosTextarea.clientHeight;memosTextarea.value+=e,memosTextarea.style.height=3*t+"px"}}),linkBtn.addEventListener("click",function(){if(l){let e="[]()";memosTextarea.value+=e}}),uploadImageInput.addEventListener("change",()=>{let t=uploadImageInput.files[0];0!==uploadImageInput.files.length&&e(t)}),submitApiBtn.addEventListener("click",function(){o(openApiInput.value)}),submitMemoBtn.addEventListener("click",function(){a=memosTextarea.value,i=memosVisibilitySelect.value,n=window.localStorage&&JSON.parse(window.localStorage.getItem("memos-resource-list"));let e=0!==a.length;if(l&&e){let e=s+"/api/memo?openId="+l,t={content:a,visibility:i,resourceIdList:n};fetch(e,{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(function(e){200==e.status&&cocoMessage.success("发送成功",()=>{location.reload()})})}else cocoMessage.info("内容不能为空")})}function setMemoTag(e){let t=e.textContent+" ";memosTextarea.value+=t}function hetiSpacing(){new Heti(".heti").autoSpacing()}function initializeYoutubePlayer(){new Plyr("#plyr",{noCookie:!1,rel:0,showinfo:0,iv_load_policy:3,modestbranding:1})}window.onload=getTotal();var memo={host:"https://demo.usememos.com/",limit:"10",creatorId:"101",domId:"#memos"};if("undefined"!=typeof memos)for(var key in memos)memos[key]&&(memo[key]=memos[key]);var limit=memo.limit,memosHost=memo.host,localUrl="https://api.eallion.com/memos/memos.json",remoteUrl="https://api.eallion.com/memos/api/memo?creatorId="+memo.creatorId+"&rowStatus=NORMAL",page=1,offset=10,nextLength=0,nextDom="",memoDom=document.querySelector(memo.domId),load='<button class="load-btn button-load">努力加载中……</button>';if(memoDom){memoDom.insertAdjacentHTML("afterend",load),getFirstList();var btn=document.querySelector("button.button-load");btn.addEventListener("click",function(){btn.textContent="努力加载中……",updateHTMl(nextDom),nextLength<limit?document.querySelector("button.button-load").remove():getNextList()})}let activeDiv=null;document.addEventListener("DOMContentLoaded",()=>{let e=6;var t="https://api.eallion.com/memos/",o=t+"api/memo/all?rowStatus=NORMAL&tag=相册&limit="+e;let a=0;fetch(o).then(e=>e.json()).then(t=>{for(var o="",i="",n=t.data,s=0;s<n.length;s++){var l=n[s].content.replace("#相册 ",""),r=n[s].id,m=l.match(/\!\[(.*?)\s*(.*?)\]\((.*?)\)/g);m&&m.forEach(t=>{if(a<e){a++;let e,i,n=t.replace(/!\[.*?\]\((.*?)\)/g,"$1"),s=t.replace(/!\[(.*?)\]\(.*?\)/g,"$1");-1!=s.indexOf(" ")?(e=s.split(" ")[0],i=s.split(" ")[1]):i=s,o+=`<div class="memos-photo"><img class="photo-img" loading='lazy' decoding="async" src="${n}" data-action="zoom">`,i&&(o+=`<a href="https://memos.eallion.com/m/${r}" target="_blank" rel="noreferrer noopener nofollow"><span class="photo-title">${i}</span></a>`),e&&(o+=`<span class="photo-time">${e}</span>`),o+="</div>"}})}var c=document.querySelector("#album"),d='<div class="memos-photo-wrapper">',u="</div>";i=d+o+u,c.innerHTML=i,window.Lately&&Lately.init({target:".photo-time"})})});var memosDom=document.querySelector("#memos"),editIcon=document.querySelector(".editIcon"),editorCont='<div class="memos-editor animate__animated animate__fadeIn d-none col-12"><div class="memos-editor-body mb-3 p-3"><div class="memos-editor-inner animate__animated animate__fadeIn"><div class="memos-editor-content"><textarea class="memos-editor-inputer text-sm" rows="1" placeholder="任何想法……"></textarea></div><div class="memos-editor-tools pt-3"><div class="d-flex"><div class="button outline action-btn tag-btn mr-2"><i class="fas fa-hashtag fa-sm"></i></div><div class="button outline action-btn todo-btn mr-2"><i class="fas fa-list fa-sm"></i></div><div class="button outline action-btn code-btn mr-2"><i class="fas fa-code fa-sm"></i></div><div class="button outline action-btn mr-2 link-btn"><i class="fas fa-link fa-sm"></i></div><div class="button outline action-btn image-btn" onclick="this.lastElementChild.click()"><i class="fas fa-images fa-sm"></i><input class="memos-upload-image-input d-none" type="file" accept="image/*"></div></div><div class="d-flex flex-fill"><div class="memos-tag-list d-none mt-2 animate__animated animate__fadeIn"></div></div></div><div class="memos-editor-footer border-t pt-3 mt-3"><div class="editor-selector mr-2"><select class="select-memos-value outline px-2 py-1"><option value="PUBLIC">所有人可见</option><option value="PROTECTED">仅登录可见</option><option value="PRIVATE">仅自己可见</option></select></div><div class="editor-submit d-flex flex-fill justify-content-end"><button class="primary submit-memos-btn px-3 py-1">记下</button></div></div></div><div class="memos-editor-option animate__animated animate__fadeIn"><input name="memos-api-url" class="memos-open-api-input input-text flex-fill mr-3 px-2 py-1" type="text" value="" maxlength="120" placeholder="输入 OpenAPI （仅保存在本地 localStorage）"><div class="memos-open-api-submit"><button class="primary submit-openapi-btn px-3 py-1">保存</button></div></div></div></div>';memosDom.insertAdjacentHTML("afterbegin",editorCont);var memosEditorInner=document.querySelector(".memos-editor-inner"),memosEditorOption=document.querySelector(".memos-editor-option"),taglistBtn=document.querySelector(".tag-btn"),todoBtn=document.querySelector(".todo-btn"),codeBtn=(todoBtn=document.querySelector(".todo-btn"),document.querySelector(".code-btn")),linkBtn=document.querySelector(".link-btn"),loadEditorBtn=document.querySelector(".load-memos-editor"),submitApiBtn=document.querySelector(".submit-openapi-btn"),submitMemoBtn=document.querySelector(".submit-memos-btn"),memosVisibilitySelect=document.querySelector(".select-memos-value"),memosTextarea=document.querySelector(".memos-editor-inputer"),openApiInput=document.querySelector(".memos-open-api-input"),uploadImageInput=document.querySelector(".memos-upload-image-input");document.addEventListener("DOMContentLoaded",()=>{getEditIcon()});