{{ define "head" }}
  {{ if .Next -}}<link rel="prefetch" href="{{ .Next.Permalink }}">{{- end }}
  {{ if .Prev -}}<link rel="prefetch" href="{{ .Prev.Permalink }}">{{- end }}
{{ end }}

{{ define "main" }}
  {{ $isntDefault := not (or (eq (trim $.Site.Params.contentTypeName " ") "posts") (eq (trim $.Site.Params.contentTypeName " ") "")) }}
  {{ $contentTypeName := cond $isntDefault (string $.Site.Params.contentTypeName) "posts" }}
  
  
  {{ $PostCate := .File.Path | replaceRE ".*posts/(.*)/.*" "$1"}}
  <div class="post {{ $PostCate }}">
    {{ partial "breadcrumb.html" . }}
  {{ if eq $PostCate "chat"}}
      {{ .Render "chat"}}
      <div class="post-content">
        <a href="{{ .Permalink }}" rel="link"><img loading="lazy" class="post-avatar avatar" src=https://dn-qiniu-avatar.qbox.me/avatar/{{ md5 "eallions@gmail.com" }} ></a>
          {{ .Content }}
      </div>
  {{ else }}
    <h2 class="post-title"><a href="{{ .Permalink }}">{{ .Title | markdownify }}</a></h2>
    <div class="post-meta">
      {{ if .Date | default nil }}
      <span class="">
        <svg class="post-meta-icon" width="18" height="18" viewBox="0 0 24 24">
          <path d="M8.627,7.885C8.499,8.388,7.873,8.101,8.13,8.177L4.12,7.143c-0.218-0.057-0.351-0.28-0.293-0.498c0.057-0.218,0.279-0.351,0.497-0.294l4.011,1.037C8.552,7.444,8.685,7.667,8.627,7.885 M8.334,10.123L4.323,9.086C4.105,9.031,3.883,9.162,3.826,9.38C3.769,9.598,3.901,9.82,4.12,9.877l4.01,1.037c-0.262-0.062,0.373,0.192,0.497-0.294C8.685,10.401,8.552,10.18,8.334,10.123 M7.131,12.507L4.323,11.78c-0.218-0.057-0.44,0.076-0.497,0.295c-0.057,0.218,0.075,0.439,0.293,0.495l2.809,0.726c-0.265-0.062,0.37,0.193,0.495-0.293C7.48,12.784,7.35,12.562,7.131,12.507M18.159,3.677v10.701c0,0.186-0.126,0.348-0.306,0.393l-7.755,1.948c-0.07,0.016-0.134,0.016-0.204,0l-7.748-1.948c-0.179-0.045-0.306-0.207-0.306-0.393V3.677c0-0.267,0.249-0.461,0.509-0.396l7.646,1.921l7.654-1.921C17.91,3.216,18.159,3.41,18.159,3.677 M9.589,5.939L2.656,4.203v9.857l6.933,1.737V5.939z M17.344,4.203l-6.939,1.736v9.859l6.939-1.737V4.203z M16.168,6.645c-0.058-0.218-0.279-0.351-0.498-0.294l-4.011,1.037c-0.218,0.057-0.351,0.28-0.293,0.498c0.128,0.503,0.755,0.216,0.498,0.292l4.009-1.034C16.092,7.085,16.225,6.863,16.168,6.645 M16.168,9.38c-0.058-0.218-0.279-0.349-0.498-0.294l-4.011,1.036c-0.218,0.057-0.351,0.279-0.293,0.498c0.124,0.486,0.759,0.232,0.498,0.294l4.009-1.037C16.092,9.82,16.225,9.598,16.168,9.38 M14.963,12.385c-0.055-0.219-0.276-0.35-0.495-0.294l-2.809,0.726c-0.218,0.056-0.351,0.279-0.293,0.496c0.127,0.506,0.755,0.218,0.498,0.293l2.807-0.723C14.89,12.825,15.021,12.603,14.963,12.385"></path>
        </svg>
      </span>
      <span class="">发布于</span>
        <span class="">
          {{ .Date.Format "2006.01.02" }}
        </span>

        {{ if eq .Type $contentTypeName }}
          {{ if $.Site.Params.LastModDisplay }}
            {{ partial "lastmod.html" . }}
          {{ end }}
        {{ end }}
      {{ end }}

      {{- if .Site.Params.waline.enable -}}
        <span> 
          <span class="post-meta-none">
            <svg class="post-meta-icon" width="18" height="18" viewBox="0 0 24 24">
              <path d="M14.999,8.543c0,0.229-0.188,0.417-0.416,0.417H5.417C5.187,8.959,5,8.772,5,8.543s0.188-0.417,0.417-0.417h9.167C14.812,8.126,14.999,8.314,14.999,8.543 M12.037,10.213H5.417C5.187,10.213,5,10.4,5,10.63c0,0.229,0.188,0.416,0.417,0.416h6.621c0.229,0,0.416-0.188,0.416-0.416C12.453,10.4,12.266,10.213,12.037,10.213 M14.583,6.046H5.417C5.187,6.046,5,6.233,5,6.463c0,0.229,0.188,0.417,0.417,0.417h9.167c0.229,0,0.416-0.188,0.416-0.417C14.999,6.233,14.812,6.046,14.583,6.046 M17.916,3.542v10c0,0.229-0.188,0.417-0.417,0.417H9.373l-2.829,2.796c-0.117,0.116-0.71,0.297-0.71-0.296v-2.5H2.5c-0.229,0-0.417-0.188-0.417-0.417v-10c0-0.229,0.188-0.417,0.417-0.417h15C17.729,3.126,17.916,3.313,17.916,3.542 M17.083,3.959H2.917v9.167H6.25c0.229,0,0.417,0.187,0.417,0.416v1.919l2.242-2.215c0.079-0.077,0.184-0.12,0.294-0.12h7.881V3.959z"></path>
            </svg>
          </span>
          <span class="comments-link post-meta-none"><span id="{{ .URL | relURL }}" class="waline-comment-count">0</span> 条评论</span> 
          <span class="post-meta-none">
            <svg class="post-meta-icon" width="18" height="18" viewBox="0 0 24 24">
              <path d="M10,6.978c-1.666,0-3.022,1.356-3.022,3.022S8.334,13.022,10,13.022s3.022-1.356,3.022-3.022S11.666,6.978,10,6.978M10,12.267c-1.25,0-2.267-1.017-2.267-2.267c0-1.25,1.016-2.267,2.267-2.267c1.251,0,2.267,1.016,2.267,2.267C12.267,11.25,11.251,12.267,10,12.267 M18.391,9.733l-1.624-1.639C14.966,6.279,12.563,5.278,10,5.278S5.034,6.279,3.234,8.094L1.609,9.733c-0.146,0.147-0.146,0.386,0,0.533l1.625,1.639c1.8,1.815,4.203,2.816,6.766,2.816s4.966-1.001,6.767-2.816l1.624-1.639C18.536,10.119,18.536,9.881,18.391,9.733 M16.229,11.373c-1.656,1.672-3.868,2.594-6.229,2.594s-4.573-0.922-6.23-2.594L2.41,10l1.36-1.374C5.427,6.955,7.639,6.033,10,6.033s4.573,0.922,6.229,2.593L17.59,10L16.229,11.373z"></path>
            </svg>
          </span>
          <span id="{{ .URL | relURL }}" class="leancloud_visitors post-meta-none" data-flag-title="{{ .Title }}"><span class="leancloud-visitors-count">0</span> 次浏览</span>
        </span>
      {{ end }}
      {{- if .Site.Params.twikoo.enable -}}
        <span> / <span id="twikoo_visitors">0</span> 阅读</span>
      {{ end }}

      {{ if $.Site.Params.ShowReadingTime }}
        <span class="post-read-time">
          <span class="">
            <svg class="post-meta-icon" width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.25,2.375c-4.212,0-7.625,3.413-7.625,7.625s3.413,7.625,7.625,7.625s7.625-3.413,7.625-7.625S14.462,2.375,10.25,2.375M10.651,16.811v-0.403c0-0.221-0.181-0.401-0.401-0.401s-0.401,0.181-0.401,0.401v0.403c-3.443-0.201-6.208-2.966-6.409-6.409h0.404c0.22,0,0.401-0.181,0.401-0.401S4.063,9.599,3.843,9.599H3.439C3.64,6.155,6.405,3.391,9.849,3.19v0.403c0,0.22,0.181,0.401,0.401,0.401s0.401-0.181,0.401-0.401V3.19c3.443,0.201,6.208,2.965,6.409,6.409h-0.404c-0.22,0-0.4,0.181-0.4,0.401s0.181,0.401,0.4,0.401h0.404C16.859,13.845,14.095,16.609,10.651,16.811 M12.662,12.412c-0.156,0.156-0.409,0.159-0.568,0l-2.127-2.129C9.986,10.302,9.849,10.192,9.849,10V5.184c0-0.221,0.181-0.401,0.401-0.401s0.401,0.181,0.401,0.401v4.651l2.011,2.008C12.818,12.001,12.818,12.256,12.662,12.412"></path>
            </svg>
          </span>{{ .ReadingTime }} {{ $.Site.Params.MinuteReadingTime | default "min read" }}
        </span>
      {{ end }}

    </div>
    {{ if eq .Type "posts" -}}
    {{ $ageDays := div (sub now.Unix .Date.Unix) 86400 }}
      {{ if gt $ageDays 180 }}
        <p class="expired-tips"> 提醒：本文最后更新于&nbsp;{{$ageDays}}&nbsp;天前，文中所描述的信息可能已发生改变，请谨慎使用。</p>
      {{ end }}
    {{ end }}
    {{ if .Params.feature }}
      {{ if .Params.UseRelativeCover }}
        <img loading='lazy' src="{{ (printf "%s%s" .Permalink .Params.feature ) }}" class="post-cover" />
      {{ else }}
        <img loading='lazy' src="{{ .Params.feature | absURL }}" class="post-cover" />
      {{ end }}
    {{ end }}
  
    <div class="post-content">
      {{ .Content }}
      {{ .Render "path"}}
    </div>
  
    {{ if .Params.toc }}
      <div class="tocify">目录：{{- partial "toc.html" . -}}</div>
    {{ end }}

    {{ if .Params.tags }}
      <span class="post-tags">
      <span class="">Tags:</span>
        {{ range .Params.tags }}
          #<a href="{{ (urlize (printf "tags/%s" . )) | absURL }}/">{{ . }}</a>&nbsp;
        {{ end }}
      </span>
    {{ end }}
  {{ end }}
    <div class="clear"></div>
    
    {{ if eq .Type $.Site.Params.contentTypeName }}
      {{ if or .Next .Prev }}
        <div class="pagination">
          <div class="pagination__title">
            {{ if and .File .Site.Params.EditPath}}
              <a class="pagination__title-h" href="https://github.com/eallion/eallion.com/edit/master/content/{{ replace .File.Path "\\" "/" }}" target="_blank" rel="noopener">阅读更多</a>
            {{ else}}
              <span class="pagination__title-h">阅读更多</span>
            {{ end }}
            <hr />
          </div>
          <div class="pagination__buttons">
            {{ if .Next }}
              <span class="button previous">
                <a href="{{ .Next.Permalink }}">
                  <span class="button__icon">←</span>
                  <span class="button__text">{{ .Next.Title }}</span>
                </a>
              </span>
            {{ end }}
            {{ if .Prev }}
              <span class="button next">
                <a href="{{ .Prev.Permalink }}">
                  <span class="button__text">{{ .Prev.Title }}</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            {{ end }}
          </div>
        </div>
      {{ end }}
    {{ end }}


    {{ if not (eq .Params.Comments "false") }}
        {{ partial "comments.html" . }}
    {{ end }}

    </div>
{{ end }}
