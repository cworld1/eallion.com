{{- define "title" }}{{ .Title }} - {{ .Site.Title }}{{ end -}}

{{- define "content" -}}
{{- $params := .Scratch.Get "params" -}}

{{- /* ECharts js */ -}}
{{- $cdn := .Scratch.Get "cdn" | default dict -}}
{{- $fingerprint := .Scratch.Get "fingerprint" -}}

{{- $source := $cdn.echartsJS | default "lib/echarts/echarts.min.js" -}}
{{- dict "Source" $source "Fingerprint" $fingerprint "Defer" true | dict "Scratch" .Scratch "Data" | partial "scratch/script.html" -}}
{{- $source := $cdn.echartsMacaronsJS | default "lib/echarts/macarons.min.js" -}}
{{- dict "Source" $source "Minify" true "Fingerprint" $fingerprint "Defer" true | dict "Scratch" .Scratch "Data" | partial "scratch/script.html" -}}

{{- /* Stats */ -}}
{{$articleCount := 0}}
{{$pageCount := 0}}
{{$categoryCount := 0}}
{{$categories := slice}}
{{$tagCount := 0}}
{{$tags := slice}}
    {{range .Site.RegularPages}}
        {{if eq .Type "posts"}}
            {{$articleCount = add $articleCount 1}}
        {{end}}
        {{if eq .Params.type "page"}}
            {{$pageCount = add $pageCount 1}}
        {{end}}
        {{if .Params.categories}}
            {{$categories = union $categories .Params.categories}}
        {{end}}
        {{if .Params.tags}}
            {{$tags = union $tags .Params.tags}}
        {{end}}
    {{end}}

{{ $posts := where .Site.RegularPages "Type" "posts" }}
{{ $stats := slice }}
{{ range $posts }}
    {{ $date := .Date.Format "2006" }}
    {{ $categories := .Params.categories }}
    {{ $stats = $stats | append (dict "date" $date "categories" $categories) }}
{{ end }}

{{$categoryCount = len $categories}}
{{$tagCount = len $tags}}

{{$scratch := newScratch}}
{{ range (where .Site.Pages "Kind" "page" )}}
    {{$scratch.Add "total" .WordCount}}
{{ end }}
{{$totalWords := $scratch.Get "total" }}

{{$categoryCounts := dict}}
{{$totalArticles := $articleCount}}

{{ $mastodon := getJSON "data/mastodon/mastodon.json" }}
{{ $statusesCount := index $mastodon 0 "account" "statuses_count" }}

{{ $neodbCount := getJSON "data/neodb/movie_details.json" }}
{{ $pentaCount := getJSON "data/penta/penta.json" }}

{{- $steam_web_api_url := "https://steam-web-api.eallion.com/ownedgames" -}}
{{- $steam_web_api := getJSON "data/steam/steam_web_api.json" -}}
{{- $steamCount :=$steam_web_api.response.game_count -}}

{{ $statsCss := resources.Get "css/stats.scss" | toCSS | minify | fingerprint "sha256" }}
<link rel="stylesheet" href="{{ $statsCss.RelPermalink }}" integrity="{{ $statsCss.Data.Integrity }}" crossorigin="anonymous">

    <div class="page single archive">
        {{- /* Title */ -}}
        <h1 class="single-title animate__animated animate__pulse animate__faster">
            {{ .Title }}
        </h1>

        <div id="content" class="content">
            <div class="">
                <ul>
                    <li>{{ T `stats_blogs` | safeHTML }}<strong><a href="/posts/">{{- $articleCount -}}</a></strong> {{ T `stats_blogs_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_pages` | safeHTML }}<strong><a href="/stats/">{{- $pageCount -}}</a></strong> {{ T `stats_pages_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_authors` | safeHTML }}<strong><a href="/authors/">2 </a></strong> {{ T `stats_authors_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_categories` | safeHTML }}<strong><a href="/categories/">{{- $categoryCount -}}</a></strong> {{ T `stats_categories_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_series` | safeHTML }}<strong><a href="/series/">3 </a></strong> {{ T `stats_series_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_tags` | safeHTML }}<strong><a href="/tags/">{{- $tagCount -}}</a></strong> {{ T `stats_tags_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_links` | safeHTML }}<strong><a href="/links/">26 </a></strong> {{ T `stats_links_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_wordcount` | safeHTML }}<strong><a href="/stats/">{{- $totalWords -}}</a></strong> {{ T `stats_wordcount_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_mastodon` | safeHTML }}<strong><a href="/toot/">{{- $statusesCount -}}</a></strong> {{ T `stats_mastodon_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_neodb` | safeHTML }}<strong><a href="/media/">{{- len $neodbCount -}}</a></strong> {{ T `stats_neodb_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_steam` | safeHTML }}<strong><a href="/steam/">{{- $steamCount -}}</a></strong> {{ T `stats_steam_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_penta` | safeHTML }}<strong><a href="/penta/">{{- len $pentaCount.penta -}}</a></strong> {{ T `stats_penta_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_views` | safeHTML }}<a>99<sup>+</sup></a> {{ T `stats_views_suffix` | safeHTML }}</li>
                    <li>{{ T `stats_comments` | safeHTML }}<a>99<sup>+</sup> </a>{{ T `stats_comments_suffix` | safeHTML }}</li>
                </ul>
            </div>

            <h3 id="{{ T `stats_ypb_header` | safeHTML }}" class="headerLink"><a href="#{{ T `stats_ypb_header` | safeHTML }}" class="header-mark" title="header-mark"></a>{{ T `stats_ypb_header` | safeHTML }}</h3>

            <details>
                <summary><span id="year_num"></span> {{ T `stats_ypb_passed` | safeHTML }}<span id="yp_text"></span><div class="year_progress_bar_container">
                    <div class="year_progress_bar_border">
                        <div class="year_progress_bar_text"><span id="year_num"></span> Progress Bar</div>
                        <div class="year_progress_bar_content">
                            <div class="year_progress grid-item">
                                <div class="bar">
                                    <div id="yp_bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div></summary>
                <div class="days">
                    <div class="days_cont" id="days_cont"></div>
                </div>
            </details>

            <h3 id="{{ T `stats_heatmap` | safeHTML }}" class="headerLink"><a href="#{{ T `stats_heatmap` | safeHTML }}" class="header-mark" title="header-mark"></a>{{ T `stats_heatmap` | safeHTML }}</h3>
            <div id="heatmap"></div>

            <h3 id="{{ T `stats_annual_header` | safeHTML }}" class="headerLink"><a href="#{{ T `stats_annual_header` | safeHTML }}" class="header-mark" title="header-mark"></a>{{ T `stats_annual_header` | safeHTML }}</h3>
            <div id="annual" data-stats='{{- $.Scratch.Get "stats" -}}'></div>

            <h3 id="{{ T `stats_category_header` | safeHTML }}" class="headerLink"><a href="#{{ T `stats_category_header` | safeHTML }}" class="header-mark" title="header-mark"></a>{{ T `stats_category_header` | safeHTML }}</h3>
            <div id="category"></div>

            <script type="text/javascript">
                // 年度进度条
                const daysContainer = document.getElementById("days_cont");
                const yBar = document.getElementById("yp_bar");
                const mBar = document.getElementById("mp_bar");
                const dBar = document.getElementById("dp_bar");
                const hBar = document.getElementById("hp_bar");
                const yText = document.getElementById("yp_text");
                const mText = document.getElementById("mp_text");
                const dText = document.getElementById("dp_text");
                const hText = document.getElementById("hp_text");
                const yNum = document.querySelectorAll("#year_num");
                let curYearPercent = 0;
                const updInterval = 750;
                let margin = getComputedStyle(document.documentElement)
                    .getPropertyValue("--gridMargin")
                    .replace("px", "");
                const daynNite = document.getElementById("day_night");

                const setDaySize = () => {
                    const { width, height } = daysContainer.getBoundingClientRect();
                    let contSize = Math.floor(Math.sqrt((width * height) / 365));
                    contSize -= margin * 2;
                    document.documentElement.style.setProperty("--day_size", contSize + "px");
                };

                const getDaysArray = (daysCount) => {
                    const wrapper = document.createDocumentFragment();
                    const startDate = new Date();
                    startDate.setDate(1);
                    startDate.setMonth(0);

                    for (let i = 1; i <= daysCount; i++) {
                        let day = document.createElement("div");
                        day.dataset.date = formatDate(startDate);
                        wrapper.append(day);
                        startDate.setDate(startDate.getDate() + 1);
                    }
                    return wrapper;
                };

                const formatDate = (date) => {
                    const months = [
                        "Jan",
                        "Feb",
                        "Mar",
                        "Apr",
                        "May",
                        "Jun",
                        "Jul",
                        "Aug",
                        "Sep",
                        "Oct",
                        "Nov",
                        "Dec",
                    ];
                    const month = months[date.getMonth()];
                    const day = date.getDate().toString().padStart(2, "0");
                    const year = date.getFullYear();
                    return `${month} ${day}, ${year}`;
                };

                const init = () => {
                    setDaySize();
                    daysContainer.append(getDaysArray(365));
                    setYearNumber();
                    startCalculating();
                    setDaysCurrent();
                    setInterval(() => {
                        startCalculating();
                    }, updInterval);
                    window.addEventListener("resize", () => {
                        daysContainer.innerHTML = "";
                        setDaySize();
                        daysContainer.append(getDaysArray(365));
                        setDaysCurrent();
                    });
                };

                const setHoursBarWidth = (date, now) => {
                    let elapsed = now - date;
                    elapsed = elapsed / 1000 / 60 / 60;
                    elapsed = Math.round(elapsed * 10000) / 100 + "%";
                    hText.textContent = elapsed;
                    hBar.style.width = elapsed;
                };

                const setDayBarWidth = (date, now) => {
                    let elapsed = now - date;
                    elapsed = elapsed / 1000 / 60 / 60 / 24;
                    elapsed = Math.round(elapsed * 100000) / 1000 + "%";
                    dText.textContent = elapsed;
                    dBar.style.width = elapsed;
                };

                const setMonthBarWidth = (date, now) => {
                    let elapsed = now - date;
                    let curMonthLength = new Date(
                        now.getFullYear(),
                        now.getMonth() + 1,
                        0
                    ).getDate();
                    elapsed = elapsed / 1000 / 60 / 60 / 24 / curMonthLength;
                    elapsed = Math.round(elapsed * 1000000) / 10000 + "%";
                    mText.textContent = elapsed;
                    mBar.style.width = elapsed;
                };

                const setYearBarWidth = (date, now) => {
                    let elapsed = now - date;
                    elapsed = elapsed / 1000 / 60 / 60 / 24 / numOfDays(now.getFullYear());
                    elapsed = Math.round(elapsed * 100000000) / 1000000;
                    curYearPercent = elapsed;
                    elapsed = elapsed.toFixed(2) + "%";
                    yText.textContent = elapsed;
                    yBar.style.width = elapsed;
                };

                const setDaysCurrent = () => {
                    const currDayNum =
                        (1 + Math.floor((curYearPercent * daysContainer.childNodes.length) / 100)) %
                        daysContainer.childNodes.length;
                    Array.from({ length: currDayNum }, (element, index) => {
                        daysContainer
                            .querySelector(`:nth-child(${index + 1})`)
                            .classList.add("passed");
                    });
                    daysContainer
                        .querySelector(`:nth-child(${currDayNum})`)
                        .classList.add("flicker", "hover-date");
                };

                const startCalculating = () => {
                    let date = new Date();
                    let now = new Date();
                    date.setMinutes(0);
                    date.setSeconds(0);
                    date.setMilliseconds(0);
                    // setHoursBarWidth(date, now);
                    date.setHours(0);
                    // setDayBarWidth(date, now);
                    date.setDate(1);
                    // setMonthBarWidth(date, now);
                    date.setMonth(0);
                    setYearBarWidth(date, now);
                };

                const setYearNumber = () => {
                    yNum.forEach((yNum) => {
                        yNum.innerText = new Date().getFullYear();
                    });
                };

                document.addEventListener("DOMContentLoaded", () => {
                    init();
                });

                const dayNightChange = () => {
                    if (!daynNite.classList.contains("light")) {
                        document.documentElement.style.setProperty("--black", "rgba(0, 107, 238, 0.75)");
                        document.documentElement.style.setProperty("--white", "#eee");
                        daynNite.classList.toggle("light");
                    } else {
                        document.documentElement.style.setProperty("--black", "#eee");
                        document.documentElement.style.setProperty("--white", "rgba(0, 107, 238, 0.75)");
                        daynNite.classList.toggle("light");
                    }
                };

                // daynNite.addEventListener("click", () => {
                //     dayNightChange();
                // });

                const numOfDays = (year) => (isLeapYear(year) ? 366 : 365);

                const isLeapYear = (year) => {
                    if (year % 4 !== 0) {
                        return false;
                    } else if (year % 100 !== 0) {
                        return true;
                    } else if (year % 400 !== 0) {
                        return false;
                    } else {
                        return true;
                    }
                };
            </script>

            <script type="text/javascript">
                // 生成热力图
                (function() {
                document.addEventListener("DOMContentLoaded", function() {
                    var heatmapChart = echarts.init(document.getElementById("heatmap"));
                    window.onresize = function() {
                        heatmapChart.resize();
                    };

                    var option;
                    var dataMap = new Map();
                    {{ range ((where .Site.RegularPages "Type" "posts")) }}
                        var key = {{ .Date.Format "2006-01-02" }};
                        var value = dataMap.get(key);
                        var link = {{ .RelPermalink}};
                        var title = {{ .Title }};

                        // multiple posts in same day
                        if (value == null) {
                        dataMap.set(key, [{link, title}]);
                        } else {
                        value.push({link, title});
                        }
                    {{- end -}}

                    var data = [];
                    for (const [key, value] of dataMap.entries()) {
                        data.push([key, value.length]);
                    }

                    var endDate = new Date();
                    var startDate = new Date(endDate);

                    // 获取屏幕宽度
                    var screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;

                    // 如果屏幕宽度适配 DoIt 主题
                    if (screenWidth >= 1440) {
                        startDate.setFullYear(startDate.getFullYear() - 1);
                    } else if (screenWidth >= 1200) {
                        startDate.setMonth(startDate.getMonth() - 10);
                    } else if (screenWidth >= 1000) {
                        startDate.setMonth(startDate.getMonth() - 9);
                    } else if (screenWidth >= 768) {
                        startDate.setMonth(startDate.getMonth() - 10);
                    } else if (screenWidth >= 680) {
                        startDate.setMonth(startDate.getMonth() - 6);
                    } else if (screenWidth >= 400) {
                        startDate.setMonth(startDate.getMonth() - 5);
                    } else if (screenWidth >= 300) {
                        startDate.setMonth(startDate.getMonth() - 5);
                    } else {
                        startDate.setFullYear(startDate.getFullYear() - 1);
                    }

                    startDate = +startDate;
                    endDate = +endDate;

                    startDate = echarts.format.formatTime('yyyy-MM-dd', startDate);
                    endDate = echarts.format.formatTime('yyyy-MM-dd', endDate);

                    var lightTheme = {
                        backgroundColor: '#fff',
                        cubeColor:'#ebedf0',
                        highlightColor: ['#006bee'],
                        dateColor: '#1f2328',
                        textBgColor: '#fff',
                        borderColor:'rgba(0, 0, 0, 0.0)',
                    };

                    var darkTheme = {
                        backgroundColor: '#34363a',
                        cubeColor:'#666',
                        highlightColor: ['#006bee'],
                        dateColor: '#666',
                        textBgColor: '#28292a',
                        borderColor:'rgba(0, 0, 0, 0.0)',
                    };

                    var currentTheme = getCurrentTheme();

                    function getCurrentTheme() {
                        const localStorageTheme = localStorage.getItem('theme');

                        if (localStorageTheme === 'dark') {
                            return darkTheme;
                        } else if (localStorageTheme === 'black') {
                            return darkTheme;
                        } else if (localStorageTheme === 'light') {
                            return lightTheme;
                        } else if (localStorageTheme === 'auto') {
                            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                                return darkTheme;
                            } else {
                                return lightTheme;
                            }
                        }
                    }

                    option = {
                        tooltip: {
                            hideDelay: 1000,
                            enterable: true,
                            backgroundColor: currentTheme.textBgColor,
                            borderWidth: 0,
                            formatter: function (p) {
                                const date = p.data[0];
                                const posts = dataMap.get(date);
                                const formattedDate = new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                                var content = `<span style="font-size: 0.75rem;font-family: var(--font-family-code);">${formattedDate}</span>`;
                                for (const [i, post] of posts.entries()) {
                                    content += "<br>";
                                    var link = post.link;
                                    var title = post.title;
                                    content += `<a href="${link}" target="_blank">《${title}》</a>` + '<br>';
                                }
                                return content;
                                }
                        },
                        visualMap: {
                            show: false,
                            inRange: {
                                color: currentTheme.highlightColor
                            },
                        },
                        calendar: {
                            left: 20,
                            top:20,
                            bottom:0,
                            right: 0,
                            cellSize: ['auto', 13],
                            range: [startDate, endDate],
                            itemStyle: {
                                color: currentTheme.cubeColor,
                                borderWidth: 3.5,
                                borderColor: currentTheme.backgroundColor,
                            },
                            yearLabel: { show: false },
                            monthLabel: {
                                nameMap: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                textStyle: {
                                    color: currentTheme.dateColor,
                            }
                        },
                            dayLabel: {
                                firstDay: 1,
                                nameMap: ['日', '一', '', '三', '', '五', ''],
                                textStyle: {
                                    color: currentTheme.dateColor
                                }
                            },
                            splitLine: {
                                lineStyle: {
                                    color: currentTheme.borderColor,
                                }
                            }
                        },
                        series: {
                            type: 'heatmap',
                            coordinateSystem: 'calendar',
                            data: data,
                        }
                    };

                    heatmapChart.setOption(option);
                    heatmapChart.on('click', function(params) {
                        if (params.componentType === 'series') {
                        const post = dataMap.get(params.data[0])[0];
                        const link = window.location.origin + post.link;
                        window.open(link, '_blank').focus();
                        }
                    });

                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.attributeName === 'theme') {
                            currentTheme = getCurrentTheme();
                            updateOption();
                            heatmapChart.setOption(option);
                            }
                        });
                    });

                    function updateOption() {
                        option.tooltip.backgroundColor = currentTheme.textBgColor;
                        option.visualMap.inRange.color = currentTheme.highlightColor;
                        option.calendar.itemStyle.color = currentTheme.cubeColor;
                        option.calendar.itemStyle.borderColor = currentTheme.backgroundColor;
                        option.calendar.monthLabel.textStyle.color = currentTheme.dateColor;
                        option.calendar.dayLabel.textStyle.color = currentTheme.dateColor;
                        option.calendar.splitLine.lineStyle.color = currentTheme.borderColor;
                    }

                    observer.observe(document.querySelector('body'), { attributes: true });
                    });
                })();
            </script>

            <script type="text/javascript">
                // 按年统计
                (function() {
                    document.addEventListener("DOMContentLoaded", function() {
                        var chartDom = document.getElementById('annual');
                        var myChart = echarts.init(chartDom, 'macarons');
                        var option;

                        // 获取文章数据
                        var articles = {{ $stats }};
                        // 获取分类数据
                        // var categories = ['所有文章', '日志', '代码', '分享', '山贼'];
                        // 获取分类数据

                        var categories = [];

                        articles.forEach(function(article) {
                            article.categories.forEach(function(category) {
                                if (!categories.includes(category)) {
                                    categories.push(category);
                                }
                            });
                        });

                        categories.unshift('{{ T `stats_total_posts` | safeHTML }}');

                        // 构造 x 轴数据
                        var currentYear = new Date().getFullYear();
                        var years = [];
                        for (var i = 2006; i <= currentYear; i++) {
                            years.push(i.toString());
                        }

                        // 构造分类数据
                        var seriesData = [];
                        for (var j = 1; j< categories.length; j++) {
                            var category = categories[j];
                            var categoryData = [];
                            for (var k = 0; k< years.length; k++) {
                                var year = years[k];
                                var count = articles.filter(function(article) {
                                    return article.date === year && article.categories.includes(category);
                                }).length;
                                categoryData.push(count);
                            }
                            seriesData.push({
                                name: category,
                                type: 'line',
                                data: categoryData
                            });
                        }

                        // 添加总文章数量序列
                        var totalData = [];
                        for (var k = 0; k< years.length; k++) {
                            var year = years[k];
                            var count = articles.filter(function(article) {
                                return article.date === year;
                            }).length;
                            totalData.push(count);
                        }
                        seriesData.unshift({
                            name: '{{ T `stats_total_posts` | safeHTML }}',
                            type: 'line',
                            stack: 'Total',
                            data: totalData
                        });

                        option = {
                            title: {
                                text: '{{ T `stats_annual_header` | safeHTML }}',
                                top: '2%',
                                left: 'center'
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            legend: {
                                data: categories,
                                top: '10%'
                            },
                            grid: {
                                left: '5%',
                                right: '5%',
                                bottom: '5%',
                                top: '20%',
                                containLabel: true
                            },
                            toolbox: {
                                feature: {
                                    saveAsImage: {
                                        title: '{{ T `stats_save_as_image` | safeHTML }}'
                                    }
                                }
                            },
                            xAxis: {
                                type: 'category',
                                boundaryGap: false,
                                data: years
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: seriesData
                        };

                        option && myChart.setOption(option);
                    });
                })();
            </script>

            <script type="text/javascript">
                // 按分类统计
                (function() {
                    document.addEventListener("DOMContentLoaded", function() {
                        var chartDom = document.getElementById('category');
                        var myChart = echarts.init(chartDom, 'macarons');
                        var option;

                        var data = [];

                        {{ range $category, $pages := .Site.Taxonomies.categories }}
                            var category = "{{ $category }}";
                            var count = {{ len $pages }};
                            data.push({ value: count, name: category + '（' + count + '）' });
                        {{ end }}

                        data.sort(function(a, b) {
                            return b.value - a.value;
                        });

                        option = {
                            title: {
                                text: '{{ T `stats_category_header` | safeHTML }}',
                                top: "2%",
                                left: "center"
                            },
                            tooltip: {
                                trigger: 'item'
                            },
                            legend: {
                                top: '10%',
                                left: 'center'
                            },
                            toolbox: {
                                feature: {
                                    saveAsImage: {
                                        title: "{{ T `stats_save_as_image` | safeHTML }}"
                                    }
                                }
                            },
                            series: [
                                {
                                name: '按分类统计',
                                type: 'pie',
                                radius: ['40%', '80%'],
                                top: '10%',
                                avoidLabelOverlap: false,
                                padAngle: 1,
                                itemStyle: {
                                    borderRadius: 10
                                },
                                label: {
                                    show: false,
                                    position: 'center'
                                },
                                emphasis: {
                                    label: {
                                    show: true,
                                    fontSize: 24,
                                    fontWeight: 'bold'
                                    }
                                },
                                labelLine: {
                                    show: false
                                },
                                data: data
                                }
                            ],
                        };
                        option.legend.data = data.map(function(item) { return item.name; });
                        option && myChart.setOption(option);
                    });
                })();
            </script>

            <h3 id="{{ T `stats_status_header` | safeHTML }}" class="headerLink"><a href="#{{ T `stats_status_header` | safeHTML }}" class="header-mark" title="header-mark"></a>{{ T `stats_status_header` | safeHTML }}</h3>

            <div class="badge">
              <a href="https://github.com/eallion/eallion.com/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/License-GLWT-green">
              </a>
              <a href="https://status.eallion.com" target="_blank" rel="noopener noreferrer">
                <img alt="Uptime Robot ratio (30 days)" src="https://img.shields.io/uptimerobot/ratio/m783953686-5912db7169eea9ce488b60c1?link=https%3A%2F%2Fstatus.eallion.com">
              </a>
              <a href="https://github.com/eallion/eallion.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/github/repo-size/eallion/eallion.com">
              </a>
              <a href="https://github.com/eallion/eallion.com/tags" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/github/v/tag/eallion/eallion.com">
              </a>
              <a href="https://github.com/eallion/eallion.com/tags" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/github/commits-since/eallion/eallion.com/v3.0.6/main">
              </a>
              <a href="https://github.com/eallion/eallion.com/commits/main" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/github/last-commit/eallion/eallion.com">
              </a>
              <a href="https://wakatime.com/@018dff59-cb93-47dc-bf2d-945cab4bdaae" target="_blank" rel="noopener noreferrer">
                <img src="https://wakatime.com/badge/user/018dff59-cb93-47dc-bf2d-945cab4bdaae/project/018dffa2-e555-41e5-b4b8-abdc7df6ea3d.svg" alt="Total time coded since Mar 2 2024" />
              </a>
            </div>

            <h3 id="{{ T `stats_thanks_header` | safeHTML }}" class="headerLink"><a href="#{{ T `stats_thanks_header` | safeHTML }}" class="header-mark" title="header-mark"></a>{{ T `stats_thanks_header` | safeHTML }}</h3>

            <div class="badge">
              <a href="https://html5.org/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/-HTML5-E34F26?style=flat&logo=html5&logoColor=white">
              </a>
              <a href="https://www.w3.org/Style/CSS/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/-CSS3-1572B6?style=flat&logo=css3&logoColor=white">
              </a>
              <a href="https://www.javascript.com/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/-JavaScript-F7DF1E?style=flat&logo=javascript&logoColor=white">
              </a>
              <a href="https://gohugo.io" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/-Hugo-FF4088?style=flat&logo=Hugo&logoColor=white">
              </a>
            </div>

            <div class="badge">
              <a href="https://www.aliyun.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Aliyun-blue?style=flat&color=blue&labelColor=555&logo=Alibaba-Cloud&logoColor=fff">
              </a>
              <a href="https://www.cloudflare.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Cloudflare-blue?style=flat&color=blue&labelColor=555&logo=cloudflare&logoColor=fff">
              </a>
              <a href="https://docker.com/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Docker-blue?style=flat&color=blue&labelColor=555&logo=Docker&logoColor=fff">
              </a>
              <a href="https://giscus.app/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Giscus-blue?style=flat&color=blue&labelColor=555&logoColor=fff&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9IndoaXRlIiBkPSJNNiAyTDIgOGwxMCAxNEwyMiA4bC00LTZ6Ii8+PC9zdmc+">
              </a>
              <a href="https://www.github.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/GitHub-blue?style=flat&color=blue&labelColor=555&logo=GitHub&logoColor=fff">
              </a>
              <a href="https://github.com/actions" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/GitHub%20Actions-blue?style=flat&color=blue&labelColor=555&logo=GitHub-Actions&logoColor=fff">
              </a>
              <a href="https://www.google.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Google-blue?style=flat&color=blue&labelColor=555&logo=Google&logoColor=fff">
              </a>
              <a href="https://fonts.google.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Google%20Fonts-blue?style=flat&color=blue&labelColor=555&logo=Google-Fonts&logoColor=fff">
              </a>
              <a href="https://gravatar.com/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Gravatar-blue?style=flat&color=blue&labelColor=555&logo=Gravatar&logoColor=fff">
              </a>
              <a href="https://iconify.design/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Iconify-blue?style=flat&color=blue&labelColor=555&logo=iconify&logoColor=fff">
              </a>
              <a href="https://www.jsdelivr.com/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/jsDelivr-blue?style=flat&color=blue&labelColor=555&logo=jsDelivr&logoColor=fff">
              </a>
              <a href="https://cloud.tencent.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Tencent%20Cloud-blue?style=flat&color=blue&labelColor=555&logo=tencent-qq&logoColor=fff">
              </a>
              <a href="https://vercel.com" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/Vercel-blue?style=flat&color=blue&labelColor=555&logo=Vercel&logoColor=fff">
              </a>
              <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">
                <img no-view src="https://img.shields.io/badge/VS%20Code-blue?style=flat&color=blue&labelColor=555&logo=visual-studio-code&logoColor=fff">
              </a>
            </div>

            <h3 id="{{ T `stats_tag_cloud` | safeHTML }}" class="headerLink"><a href="#{{ T `stats_tag_cloud` | safeHTML }}" class="header-mark" title="header-mark"></a><a href="/tags/">{{ T `stats_tag_cloud` | safeHTML }}</a></h3>
            <div class="tag-cloud-tags">
                {{- range $.Site.Taxonomies.tags.ByCount -}}
                    <a href="{{ .Page.RelPermalink }}"><div class="tags-shields"><div class="tags-shields-before">{{ .Page.Title }}</div><div class="tags-shields-after tags-count-{{ .Count }}">{{ .Count }}</div></div></a>
                {{- end -}}
            </div>

            {{- dict "Content" .Content "Ruby" $params.ruby "Fraction" $params.fraction "Fontawesome" $params.fontawesome | partial "function/content.html" | safeHTML -}}

            <!--
            <script>
                // 超时函数
                function timeout(ms) {
                    return new Promise((_, reject) => setTimeout(() => reject(new Error('Request timeout')), ms));
                }

                // NeoDB 数量
                // 发起请求并处理响应
                // Promise.race([
                //     fetch('https://neodb.eallion.com/api?page=1'),
                //     timeout(5000) // 设置超时时间（以毫秒为单位）
                // ])
                //     .then(response => response.json())
                //     .then(data => {
                //         // 获取 id="neodb-count" 的元素
                //         const neodbElement = document.getElementById('neodb-count');

                //         // 将 count 值插入到元素中
                //         neodbElement.textContent = data.count;
                //     })
                //     .catch(error => {
                //         console.error('Error fetching NeoDB data:', error);
                //     });

                // Mastodon 数量
                // 发起请求并处理响应
                // Promise.race([
                //     fetch('https://memos.eallion.com/api/v1/memo/stats?creatorId=101'),
                //     timeout(5000) // 设置超时时间（以毫秒为单位）
                // ])
                //     .then(response => response.json())
                //     .then(data => {
                //         // 获取 id="mastodon-count" 的元素
                //         const mastodonCountElement = document.getElementById('mastodon-count');

                //         // 计算数组数量
                //         const arrayCount = Object.keys(data).length;

                //         // 将数组数量插入到元素中
                //         mastodonCountElement.textContent = arrayCount;
                //     })
                //     .catch(error => {
                //         console.error('Error fetching Mastodon data:', error);
                //     });

                // Steam 游戏数量
                // 发起请求并处理响应
                Promise.race([
                    fetch('https://steam-web-api.eallion.com/ownedgames'),
                    timeout(5000) // 设置超时时间（以毫秒为单位）
                ])
                    .then(response => response.json())
                    .then(data => {
                        // 获取 id="mastodon-count" 的元素
                        const steamCountElement = document.getElementById('steam-count');

                        // 将 count 值插入到元素中
                        steamCountElement.textContent = data.response.game_count;
                    })
                    .catch(error => {
                        console.error('Error fetching Mastodon data:', error);
                    });
            </script>
            -->

        </div>
    </div>
{{- end -}}
