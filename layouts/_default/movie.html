{{- define "title" }}{{ .Title }} - {{ .Site.Title }}{{ end -}}

{{- define "content" -}}
{{- $params := .Scratch.Get "params" -}}
{{- $toc := $params.toc -}}
{{- if eq $toc true -}}
{{- $toc = .Site.Params.page.toc | default dict -}}
{{- else if eq $toc false -}}
{{- $toc = dict "enable" false -}}
{{- end -}}

<style>
    .movie {
        margin-top: 1.5rem;
        width: 100vw;
        margin-left: calc(50% - 50vw);
        display: grid;
        grid-gap: 2px;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    }

    .card {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        position: relative;
        overflow: hidden;
        border-radius:4px;
    }

    .card:hover .details {
        bottom: 0;
        transition: all .5s;
    }

    .card:hover .poster:before {
        bottom: 0;
    }

    .card:hover .poster img {
        filter: blur(2px);
        transform: translateY(-40px);
    }

    .card .poster {
        position: relative;
        overflow: hidden;
        width: 100%;
        height: 100%;
    }

    .card .poster img {
        width: 100%;
        transition: .5s;
        height: 400px;
        object-fit: cover;
    }

    .card .poster:before {
        content: '';
        position: absolute;
        background: linear-gradient(0deg, rgba(0, 0, 0, 0.808) 60%, transparent);
        height: 100%;
        width: 100%;
        z-index: 1;
        bottom: 0;
        bottom: -100%;
        left: 0;
        transition: .5s;
    }

    .details {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-end;
        position: absolute;
        padding: 15px;
        width: 100%;
        height: 82%;
        box-sizing: border-box;
        left: 0;
        bottom: -400px;
        z-index: 2;
        transition: all .4s ease;
    }

    .details h2 {
        color: #fff;
        font-size: 20px;
        margin: 0;
        padding: 0;
    }

    .details h2 a {
        color: #006bee !important;
        text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white, 1px 1px 0 white;
    }


    .details h2 a:hover {
        color: #ef3982 !important;
    }

    .details span {
        font-size: .875rem;
        color: #ff9800;
    }

    .rating,
    .rating_star,
    .rating_full,
    .rating_empty {
        display: flex;
    }

    .rating_star {
        position: relative;
        padding: 0;
        color: #f7f406;
    }


    .rating_empty {
        overflow: hidden;
        position: absolute;
        top: 0;
    }

    .rating_icon {
        fill: currentColor;
        flex-shrink: 0;
    }

    .rating span {
        margin-left: 0.25rem;
    }

    .tags {
        position: relative;
        margin-top: 5px;
    }

    .tags span {
        padding: 2px 5px;
        margin-top: 2px;
        display: inline-block;
        border-radius: 4px;
        color: #fff;
    }

    .tags span:nth-child(1) {
        background-color: #f70661;
    }

    .tags span:nth-child(2) {
        background-color: #7206f7;
    }

    .tags span:nth-child(3) {
        background-color: #f79d06;
    }

    .tags span:nth-child(4) {
        background-color: #06f7a8;
    }

    .tags span:nth-child(5) {
        background-color: #06a5f7;
    }

    .tags span:nth-child(6) {
        background-color: #f70693;
    }

    .tags span:nth-child(7) {
        background-color: #7254f7;
    }

    .tags span:nth-child(8) {
        background-color: #f7e606;
    }

    .tags span:nth-child(9) {
        background-color: #06f76f;
    }

    .tags span:nth-child(10) {
        background-color: #06a5a9;
    }

    .info {
        color: #fff;
    }

    .info p {
        font-size: 0.875rem;
        margin: 15px 0 10px;
        line-height: 1.5 !important;
        display: -webkit-box;
        -webkit-line-clamp: 5;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .star {
        position: relative;
        display: flex;
        align-items: center;
    }

    .star h4 {
        color: #fff;
        margin: 0 !important;
        padding: 0 !important;
        font-size: 20px;
    }

    .star ul {
        padding-left: 10px !important;
        padding: 0;
        margin: 0 !important;
        display: flex;
    }

    .star ul li {
        list-style: none;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid #fff;
    }

    .star ul li:not(:first-child) {
        margin-left: -10px;
    }

    .star ul li img {
        width: 100%;
    }

    /* // 页面宽度小于700样式 */
    @media (max-width:700px){
        .movie{
            width: 100%;
            margin-left:0;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }

        .card .poster img {
            height: 180px;
        }

        .details {
            display: none;
        }
    }
    /* // 页面宽度大于700小于900样式 */
    @media screen and (min-width:700px) and (max-width:900px){
        .movie{
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        .card .poster img {
            height: 200px;
        }

        .details {
            display: none;
        }
    }
    /* // 页面宽度大于900样式    */
    @media (min-width:900px){
        .details {
            display: flex;
        }
    }
</style>

{{ $movies := getJSON "data/neodb/movie.json" }}
{{ $comment_text := $movies.item.comment_text }}

{{ $movie_details := getJSON "data/neodb/movie_details.json" }}

<article class="page single special">
    <h1 class="single-title animate__animated animate__pulse animate__faster">{{ .Title }}</h1>
    <div id="content" class="content movies">
        <div class="greyQuote">
            <blockquote>{{ T `movie_quote` | safeHTML }}</blockquote>
        </div>
        {{- dict "Content" .Content "Ruby" $params.ruby "Fraction" $params.fraction "Fontawesome" $params.fontawesome | partial "function/content.html" | safeHTML -}}

        <div class="movie">

            {{ range $movie_details }}
            {{ $title := .display_title }}
            {{ $orig_title := .orig_title }}
            {{ $year := .year }}
            {{ $rating := float .rating }}
            {{ $rating_percent := mul $rating 10 }}
            {{ $movie_url := .url }}
            {{ $imdb := .imdb}}
            {{ $cover := .cover_image_url }}
            {{ $cover_name := path.Base $cover }}
            {{ $brief := .brief }}
            {{ $cate_movie := "movie" }}
            {{ $cate_tv := "tv" }}

            <div class="card">
                <div class="poster">
                    <img alt="{{- $title -}}" class="lazy" loading="lazy" src="/assets/images/movie/cover/{{- $cover_name -}}" data-src="/assets/images/movie/cover/{{- $cover_name -}}" no-view>
                </div>
                <div class="details">
                    <h2><a href="https://neodb.social{{- $movie_url -}}" target="_blank" rel="noreferrer noopener nofollow">{{- $title -}}</a><br><span>{{- $orig_title | default $title -}} ({{- $year -}})</span></h2>

                    <div class="rating">
                        <div class="rating_star">
                            <div class="rating_full"><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="M235.38 98.53A11.82 11.82 0 0 0 225 90.29l-59.45-5.14a4 4 0 0 1-3.32-2.44L139 27.36a11.95 11.95 0 0 0-22.06 0l-23.2 55.35a4 4 0 0 1-3.32 2.44L31 90.29a12 12 0 0 0-6.83 21.07l45.1 39.35a4 4 0 0 1 1.28 4L57 213.22a11.88 11.88 0 0 0 4.67 12.48a11.76 11.76 0 0 0 13.19.53l51.1-31a3.89 3.89 0 0 1 4.08 0l51.1 31a12 12 0 0 0 17.86-13l-13.52-58.54a4 4 0 0 1 1.28-4l45.1-39.35a11.89 11.89 0 0 0 3.52-12.81m-8.78 6.8l-45.1 39.35a12 12 0 0 0-3.82 11.8L191.2 215a4 4 0 0 1-1.56 4.2a3.86 3.86 0 0 1-4.35.17l-51.1-31a11.88 11.88 0 0 0-12.38 0l-51.1 31a3.86 3.86 0 0 1-4.35-.17a4 4 0 0 1-1.56-4.2l13.52-58.54a12 12 0 0 0-3.82-11.8l-45.1-39.33a4 4 0 0 1-1.18-4.33a4 4 0 0 1 3.44-2.75l59.45-5.14a12 12 0 0 0 10-7.31l23.22-55.36a4 4 0 0 1 7.32 0l23.22 55.36a12 12 0 0 0 10 7.31l59.45 5.14a4 4 0 0 1 3.44 2.75a4 4 0 0 1-1.16 4.33"/></svg></div>
                            <div class="rating_empty" style="width: {{- $rating_percent -}}%;"><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg><svg focusable="false" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256" class="rating_icon"><path fill="currentColor" d="m234.5 114.38l-45.1 39.36l13.51 58.6a16 16 0 0 1-23.84 17.34l-51.11-31l-51 31a16 16 0 0 1-23.84-17.34l13.49-58.54l-45.11-39.42a16 16 0 0 1 9.11-28.06l59.46-5.15l23.21-55.36a15.95 15.95 0 0 1 29.44 0L166 81.17l59.44 5.15a16 16 0 0 1 9.11 28.06Z"/></svg></div>
                        </div>
                        <span>{{- $rating | default "Null" -}}</span>
                    </div>

                    <div class="tags">
                        {{ range first 5 .genre }}
                            <span class="">{{- . -}}</span>
                        {{ end }}
                    </div>

                    <div class="info">
                        {{ $id := .id }}
                        {{ range $item := $movies.data }}
                            {{ if eq $item.item.id $id }}
                                {{ $comment_text := .comment_text }}
                                {{ if $comment_text }}
                                    <p>短评：{{ $comment_text }}</p>
                                {{ else }}
                                    <p>简介：{{ $brief }}</p>
                                {{ end }}
                            {{ end }}
                        {{ end }}
                    </div>

                    <div class="star">
                        <h4>Info:</h4>
                        <ul>
                            <li class="neodb">
                                <a href="https://neodb.social{{- $movie_url -}}" target="_blank" rel="noreferrer noopener nofollow">
                                    <img class="lazy" src="/assets/images/movie/neodbsocial.jpg" loading="lazy" alt="NeoDB" no-view>
                                </a>
                            </li>
                            {{ range .external_resources }}
                                {{ $parsedURL := urls.Parse .url }}
                                {{ $host := $parsedURL.Hostname }}
                                {{ $title := .title }}
                                    {{ if not (strings.Contains .url "imdb.com") }}
                                        <li class="external-resource">
                                            <a href="{{- .url -}}" target="_blank" rel="noreferrer noopener nofollow">
                                                <img class="lazy" src="/assets/images/movie/{{- $host -}}.png" loading="lazy" alt="{{- $title -}}" no-view>
                                            </a>
                                        </li>
                                    {{ end }}
                            {{ end }}
                            {{ if and ($imdb) (ne $imdb "") }}
                                <li class="imdb">
                                    <a href="https://www.imdb.com/title/{{- $imdb -}}" target="_blank" rel="noreferrer noopener nofollow">
                                        <img class="lazy" src="/assets/images/movie/www.imdb.com.png" loading="lazy" alt="IMDB" no-view>
                                    </a>
                                </li>
                            {{ end }}
                        </ul>

                    </div>
                </div>
            </div>

            {{ end }}

        </div>

    </div>
</article>

<script async type="text/javascript" src="/assets/js/lazyload.iife.min.js?v=17.8.5"></script>

<script>
    var lazyLoadInstance = new LazyLoad({
        // Your custom settings go here
    });
</script>

{{ end }}
