{{ define "main" }}
{{ .Scratch.Set "scope" "single" }}

{{ $links := getJSON "data/friends/links.json" }}

{{ $linksCss := resources.Get "css/links.scss" | toCSS | minify | fingerprint "sha256" }}
<link rel="stylesheet" href="{{ $linksCss.RelPermalink }}" integrity="{{ $linksCss.Data.Integrity }}" crossorigin="anonymous">

<article>
  {{ if .Params.showHero | default (.Site.Params.article.showHero | default false) }}
  {{ $heroStyle := .Params.heroStyle }}
  {{ if not $heroStyle }}{{ $heroStyle = .Site.Params.article.heroStyle }}{{ end }}
  {{ $heroStyle := print "partials/hero/" $heroStyle ".html" }}
  {{ if templates.Exists $heroStyle }}
  {{ partial $heroStyle . }}
  {{ else }}
  {{ partial "partials/hero/basic.html" . }}
  {{ end }}
  {{ end }}

  <header id="single_header" class="mt-5 max-w-prose">
    {{ if .Params.showBreadcrumbs | default (.Site.Params.article.showBreadcrumbs | default false) }}
    {{ partial "breadcrumbs.html" . }}
    {{ end }}
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      {{ .Title | emojify }}
    </h1>

    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      {{ partial "article-meta/basic.html" (dict "context" . "scope" "single") }}
    </div>

  </header>

  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">

      <div class="min-w-0 min-h-0 max-w-fit">

        <div class="article-content max-w-full mb-20 break-words">

            {{ .Content | emojify }}

            <div class="friends links">
                {{ range $links.links }}
                {{ $name := .name }}
                {{ $bio := .bio }}
                {{ $url := .url }}
                {{ $domainScheme := (replace (replace $url "http://" "") "https://" "") }}
                {{ $domainParts := split $domainScheme "/" }}
                {{ $domain := index $domainParts 0 }}
                {{ $avatar := .avatar }}
                <a target="_blank" href="/go/?target={{- $url | base64Encode -}}" title="{{- $name -}}" class="friend-link" rel="noopener noreferrer">
                    <div class="friend-link-div">
                        <div class="friend-link-avatar">
                            <img class="lazy nozoom" loading="lazy" src="{{- $avatar -}}" alt="{{- $name -}}" onerror="this.onerror=null; this.src='/404.png';">
                        </div>
                        <div class="friend-link-info">
                            <div class="friend-name-div">
                                <span class="friend-favicon"><img class="lazy nozoom" alt src="https://api.eallion.com/favicon/{{- $url | base64Encode -}}"></span>
                                <i class="friend-name">{{- $name -}}</i>
                            </div>
                            <p class="friend-bio">{{- $bio -}}</p>
                        </div>
                        <div class="friend-screens">
                            <img class="lazy nozoom" loading="lazy" alt src="https://api.eallion.com/screens/{{- strings.TrimSuffix "/" $domain -}} ">
                        </div>
                    </div>
                </a>
                {{ end }}
            </div>

        </div>

      </div>

    </section>

</article>

{{ $lazyloadJS := resources.Get "js/lazyload.iife.min.js" | minify | fingerprint "sha256" }}
<script type="text/javascript" src="{{ $lazyloadJS.RelPermalink }}" integrity="{{ $lazyloadJS.Data.Integrity }}"></script>

<script>
    var lazyLoadInstance = new LazyLoad({
        // Your custom settings go here
    });
</script>

{{ end }}
